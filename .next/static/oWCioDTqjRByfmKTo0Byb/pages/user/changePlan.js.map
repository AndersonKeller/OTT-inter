{"version":3,"sources":["webpack:///./node_modules/next/dist/build/webpack/loaders/next-client-pages-loader.js?fd89","webpack:///./node_modules/@charlietango/use-client-hydrated/lib/useClientHydrated.esm.js","webpack:///./node_modules/@charlietango/use-script/lib/useScript.esm.js","webpack:///./pages/user/changePlan/index.js","webpack:///./components/withAuth/index.js"],"names":["window","__NEXT_P","push","ScriptStatus","url","clientHydrated","_useState","script","document","querySelector","hasAttribute","getAttribute","LOADING","IDLE","status","setStatus","createElement","src","async","setAttribute","head","appendChild","onerror","ERROR","onload","READY","eventHandler","e","type","addEventListener","removeEventListener","ChangePlanPage","api","layoutProps","packages","useScript","ready","useState","isPayUReady","setIsPayUReady","POS","HAS_WINDOW","POSStyle","base","borderRadius","backgroundColor","height","fontSize","padding","marginLeft","cardImage","borderTopRightRadius","borderBottomRightRadius","margin","pan","width","borderTopLeftRadius","borderBottomLeftRadius","expirationDate","secureFields","left","cvv","console","log","useEffect","_","setPublicKey","setEnvironment","setStyle","setCardNumberPlaceholder","setExpirationDatePlaceholder","CONFIG","appName","style","lineHeight","readOnly","package_id","plan","id","name","currency","amount","getInitialProps","ctx","a","get","data","items","error","withAuth","getDisplayName","WrappedComponent","displayName","update","WithAuth","props","useContext","UserContext","user","updateUser","Router","nookies","set","JSON","stringify","path","userString","SafeJSONParse","value","pathname","res","redirectRoute","redirect","end","replace","componentProps","withApi"],"mappings":"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","file":"static/oWCioDTqjRByfmKTo0Byb/pages/user/changePlan.js","sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/user/changePlan\",\n      function () {\n        return require(\"private-next-pages/user/changePlan/index.js\");\n      }\n    ]);\n  ","import { useEffect } from 'react';\n\nvar clientHydrated = false;\n/**\n * Returns false when serverside rendering and during the first render pass (hydration) in the client.\n * Use this to modify behavior of components when they can be certain they are running client side.\n * Like check a media query during the initial render.\n * */\n\nfunction useClientHydrated() {\n  useEffect(function () {\n    if (!clientHydrated) clientHydrated = true;\n  }, []);\n  return clientHydrated;\n}\n\nexport default useClientHydrated;\n","import { useState, useEffect } from 'react';\nimport useClientHydrated from '@charlietango/use-client-hydrated';\n\nvar ScriptStatus;\n/**\n * Hook to load an external script. Returns true once the script has finished loading.\n *\n * @param url {string} url The external script to load\n * */\n\n(function (ScriptStatus) {\n  ScriptStatus[\"IDLE\"] = \"idle\";\n  ScriptStatus[\"LOADING\"] = \"loading\";\n  ScriptStatus[\"READY\"] = \"ready\";\n  ScriptStatus[\"ERROR\"] = \"error\";\n})(ScriptStatus || (ScriptStatus = {}));\n\nfunction useScript(url) {\n  var clientHydrated = useClientHydrated();\n\n  var _useState = useState(function () {\n    if (clientHydrated) {\n      var script = document.querySelector(\"script[src=\\\"\" + url + \"\\\"]\");\n\n      if (script && script.hasAttribute('data-status')) {\n        return script.getAttribute('data-status');\n      }\n    }\n\n    return url ? ScriptStatus.LOADING : ScriptStatus.IDLE;\n  }),\n      status = _useState[0],\n      setStatus = _useState[1];\n\n  useEffect(function () {\n    if (!url) {\n      setStatus(ScriptStatus.IDLE);\n      return;\n    }\n\n    var script = document.querySelector(\"script[src=\\\"\" + url + \"\\\"]\");\n\n    if (!script) {\n      script = document.createElement('script');\n      script.src = url;\n      script.async = true;\n      script.setAttribute('data-status', ScriptStatus.LOADING);\n      document.head.appendChild(script); // Ensure the status is loading\n\n      setStatus(ScriptStatus.LOADING);\n\n      script.onerror = function () {\n        if (script) script.setAttribute('data-status', ScriptStatus.ERROR);\n      };\n\n      script.onload = function () {\n        if (script) script.setAttribute('data-status', ScriptStatus.READY);\n      };\n    } else if (script.hasAttribute('data-status')) {\n      setStatus(script.getAttribute('data-status'));\n    }\n\n    var eventHandler = function eventHandler(e) {\n      setStatus(e.type === 'load' ? ScriptStatus.READY : ScriptStatus.ERROR);\n    }; // Add load event listener\n\n\n    script.addEventListener('load', eventHandler);\n    script.addEventListener('error', eventHandler);\n    return function () {\n      if (script) {\n        script.removeEventListener('load', eventHandler);\n        script.removeEventListener('error', eventHandler);\n      }\n    };\n  }, [url]);\n  return [status === ScriptStatus.READY, status];\n}\n\nexport default useScript;\nexport { ScriptStatus };\n","// next\nimport Head from 'next/head'\n\n// env\nimport { CONFIG }     from '~/config'\nimport { HAS_WINDOW } from '~/constants/constants'\n\n// react\nimport { useEffect, useState } from 'react'\n\nimport useScript, { ScriptStatus }  from '@charlietango/use-script'\nimport nookies                      from 'nookies'\n\n// components\nimport Layout           from '~/components/layout/Layout'\nimport { PackageRadio } from '~/components/Packages'\nimport ChangePlanForm   from './form'\nimport withAuth         from '~/components/withAuth'\n\n// page\nconst ChangePlanPage = ({ api, layoutProps, packages }) => {\n  const [ ready, status ] = useScript('https://js.paymentsos.com/v2/latest/secure-fields.min.js')\n  const [ isPayUReady, setIsPayUReady ] = useState(false)\n\n  const businessUnitPublicKey = '88985036-6530-4b5a-a7ec-c4e07ec07f6c'\n  const POS = ready && HAS_WINDOW ? window.POS : null\n  const payUEnv = 'test'\n\n  const POSStyle = {\n    base: {\n      borderRadius: '.15rem',\n      backgroundColor: 'white',\n      height: 'calc(1.5em + .75rem + 2px)',\n      fontSize: '12px',\n      padding:'0px 3px',\n      marginLeft: '5px',\n      cardImage: {\n        borderTopRightRadius: 0,\n        borderBottomRightRadius: 0,\n        margin: 0,\n      },\n      pan:{\n        width:'160px',\n        borderTopLeftRadius: 0,\n        borderBottomLeftRadius: 0,\n        marginLeft: 0,\n      },\n      expirationDate: { width: '47px' },\n      secureFields: { left: '40px' },\n      cvv: { width: '35px' }\n    }\n  }\n\n  if (status === ScriptStatus.ERROR) {\n    console.log('Failed to load POS API')\n  }\n\n  useEffect(_ => {\n    if (POS) {\n      POS.setPublicKey(businessUnitPublicKey)\n      POS.setEnvironment(payUEnv)\n      POS.setStyle(POSStyle)\n      POS.setCardNumberPlaceholder('Tarjeta de crédito')\n      POS.setExpirationDatePlaceholder('MM/AA')\n      setIsPayUReady(true)\n    }\n  }, [POS])\n\n  return (\n    <Layout {...layoutProps}>\n      <Head>\n        <title>Cambiar &lt; Plan &lt; {CONFIG.appName}</title>\n      </Head>\n      <div className=\"rgpage container-fluid\">\n        <div className=\"row\">\n          <div className=\"col-xl-8 offset-xl-2\">\n\n            <h1 className=\"h2\">Tú Plan Actual</h1>\n            {/* <PackageRadio readOnly package_id=\"1\"\n              plan={{ id: '1', name:'6 meses', currency: 'ars', amount: '594'}}\n            /> */}\n\n            <div className=\"col col-md-4 text-left vertical-align\" style={{fontSize: '16px', lineHeight: 1}}>\n              <PackageRadio\n                readOnly\n                package_id=\"1\"\n                plan={{\n                  id: '1',\n                  name:'6 meses',\n                  currency: 'ars',\n                  amount: '594'\n                }}\n              />\n            </div>\n\n            <h1 className=\"h2\">Nuevo Plan</h1>\n            <ChangePlanForm {...{api, isPayUReady, packages, POS}} />\n\n          </div>\n        </div>\n      </div>\n      <style jsx>{`\n        .rgpage {\n          padding-top: 40px;\n          padding-bottom: 120px;\n        }\n        .h2 {\n          margin-bottom: 10px;\n        }\n      `}</style>\n    </Layout>\n  )\n}\n\n// getInitialProps\nChangePlanPage.getInitialProps = async ctx => {\n\n  const { api } = ctx\n\n  // get packages\n  let packages\n  try {\n    const { data } = await api.get('packages')\n    packages = { items: data }\n  } catch(error) {\n    packages = { error }\n  }\n\n  return { packages }\n}\n\nexport default withAuth(ChangePlanPage)\n","import SafeJSONParse from 'json-parse-safe'\nimport React, { useContext, useEffect } from 'react'\nimport Router from 'next/router'\nimport nookies from 'nookies'\nimport UserContext from '~/contexts/UserContext'\nimport withApi from '~/components/withApi'\n\nconst withAuth = (WrappedComponent, update = false) => {\n\n  const WithAuth = props => {\n    const { user, updateUser } = useContext(UserContext)\n    useEffect( _ => {\n      if ( ! user) {\n        Router.push('/')\n      }\n    }, [user])\n    return <WrappedComponent updateUser={updateUser} {...props} />\n  }\n\n  WithAuth.getInitialProps = async ctx => {\n    const { api } = ctx\n    let user\n    if (update) {\n      try {\n\n        // get updated user\n        const { data } = await api.get('user')\n        user = data\n\n        // set user to cookies\n        nookies.set(ctx, 'user', JSON.stringify(user), { path: '/' })\n\n      } catch(error) { }\n    } else {\n      const { user: userString } = nookies.get(ctx, 'user')\n      user = SafeJSONParse(userString).value\n    }\n    if ( ! user ) {\n      const { pathname, res } = ctx\n      const redirectRoute = `/login?redirectTo=${pathname}`\n      console.log('redirectroute', redirectRoute)\n      if (res) {\n        res.redirect(redirectRoute)\n        res.end()\n      } else {\n        Router.replace(redirectRoute)\n      }\n      return { }\n    }\n    if (WrappedComponent.getInitialProps) {\n\n      // append user to the context\n      ctx.user = user\n\n      const componentProps = await WrappedComponent.getInitialProps(ctx)\n      return { user, ...componentProps }\n    } else {\n      return { user }\n    }\n  }\n\n  WithAuth.displayName = `WithAuth(${getDisplayName(WrappedComponent)})`;\n\n  // wrap this hoc on withApi hoc\n  return withApi(WithAuth)\n}\n\nfunction getDisplayName(WrappedComponent) {\n  return WrappedComponent.displayName || WrappedComponent.name || 'Component';\n}\n\nexport default withAuth\n"],"sourceRoot":""}