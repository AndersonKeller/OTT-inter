{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _react = require(\"react\");\n\nvar _UserContext = _interopRequireDefault(require(\"../../../contexts/UserContext\"));\n\nvar _api = _interopRequireWildcard(require(\"../../../services/api\"));\n\nvar _constants = require(\"../../../constants/constants\");\n\nvar _auth = require(\"../../../services/auth\");\n\nvar _FormGroup = _interopRequireDefault(require(\"./FormGroup\"));\n\nvar _Input = _interopRequireDefault(require(\"./Input\"));\n\nvar _FormText = _interopRequireDefault(require(\"./FormText\"));\n\nvar _button = _interopRequireDefault(require(\"../../button\"));\n\nvar _AuthModalContext = require(\"../../../contexts/AuthModalContext\");\n\nvar _nookies = _interopRequireDefault(require(\"nookies\"));\n\nvar _SocialButtons = _interopRequireDefault(require(\"./SocialButtons\"));\n\nvar _config = require(\"~/config\");\n\nvar _OrEnterWith = _interopRequireDefault(require(\"./OrEnterWith\"));\n\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst LoginTab = ({\n  changeTab,\n  setLoading,\n  socialLogin\n}) => {\n  const {\n    0: email,\n    1: setEmail\n  } = (0, _react.useState)('');\n  const {\n    0: password,\n    1: setPassword\n  } = (0, _react.useState)('');\n  const {\n    0: error,\n    1: setError\n  } = (0, _react.useState)('');\n  const {\n    signIn\n  } = (0, _react.useContext)(_UserContext.default);\n  const {\n    closeAuthModal,\n    code,\n    socialProvider\n  } = (0, _react.useContext)(_AuthModalContext.AuthModalContext);\n\n  const providerLogin = async _ => {\n    try {\n      setLoading(true);\n\n      const {\n        pkg_int_id: package_id_intention\n      } = _nookies.default.get({}, 'pkg_int_id');\n\n      const tokenResponse = await (0, _api.default)().post(`auth/${socialProvider}/callback`, {\n        code,\n        client_id: _constants.CLIENT_ID,\n        client_secret: _constants.CLIENT_SECRET,\n        package_id_intention\n      });\n      const {\n        access_token\n      } = tokenResponse.data;\n      (0, _auth.setAccessToken)(access_token);\n      const userResponse = await (0, _api.default)().get('/user');\n      setLoading(false);\n      signIn(userResponse.data, tokenResponse.data);\n      closeAuthModal();\n    } catch (error) {\n      console.table(error);\n      setError('An error has occurred!');\n      setLoading(false);\n    }\n  };\n\n  (0, _react.useEffect)(() => {\n    if (code && socialProvider) providerLogin();\n  }, []);\n\n  async function handleSubmit(e) {\n    e.preventDefault();\n    setLoading(true);\n    document.activeElement.blur();\n\n    try {\n      const tokenResponse = await (0, _api.default)().post(`${_api.baseURL}/oauth/token`, {\n        grant_type: 'password',\n        client_id: _constants.CLIENT_ID,\n        client_secret: _constants.CLIENT_SECRET,\n        username: email,\n        password,\n        scope: ''\n      });\n      const {\n        access_token\n      } = tokenResponse.data;\n      (0, _auth.setAccessToken)(access_token);\n      const userResponse = await (0, _api.default)().get('/user');\n      signIn(userResponse.data, tokenResponse.data);\n      closeAuthModal();\n    } catch (error) {\n      if (error.response) {\n        const {\n          data,\n          status\n        } = error.response;\n        const message = status === 400 ? 'Correo electrónico o contraseña incorrectos. Inténtalo de nuevo' : status === 403 ? 'Tu dirección de correo electrónico no está verificada' : status === 500 ? 'Servidor, base de datos o conexión no disponible' : data.message;\n        setError(message);\n      } else {\n        setError('An error has occurred!');\n        console.log('error', error);\n      }\n    }\n\n    setLoading(false);\n  }\n\n  function goToPasswordRecovery(e) {\n    e.preventDefault();\n    changeTab('password');\n  }\n\n  function goToRegister(e) {\n    e.preventDefault();\n    changeTab('register');\n  }\n\n  const notRegistered = _config.CONFIG.lang === 'es-CL' ? '¿No estás suscrito?' : '¿No es suscriptor?';\n  return __jsx(\"div\", null, __jsx(\"div\", {\n    className: \"intro-text\"\n  }, __jsx(\"p\", null, \"\\xA1Bienvenidos!\")), __jsx(\"form\", {\n    method: \"post\",\n    onSubmit: handleSubmit\n  }, error && __jsx(\"div\", {\n    className: \"invalid-feedback\"\n  }, error), __jsx(_FormGroup.default, null, __jsx(_Input.default, {\n    id: \"email\",\n    autoComplete: \"username\",\n    placeholder: \"E-mail\",\n    onChange: e => setEmail(e.target.value),\n    required: true,\n    type: \"email\",\n    value: email\n  })), __jsx(_FormGroup.default, null, __jsx(_Input.default, {\n    id: \"clave\",\n    autoComplete: \"current-password\",\n    placeholder: \"Clave\",\n    onChange: e => setPassword(e.target.value),\n    required: true,\n    type: \"password\",\n    value: password\n  }), __jsx(_FormText.default, null, __jsx(\"a\", {\n    href: \"#\",\n    onClick: goToPasswordRecovery\n  }, \"\\xBFOlvidaste tu clave?\"))), __jsx(_button.default, {\n    block: true,\n    className: \"enter-btn\",\n    size: \"sm\",\n    type: \"submit\"\n  }, \"Entrar\"), __jsx(\"div\", {\n    className: \"already-subscriptor\"\n  }, __jsx(\"span\", null, notRegistered), ' ', __jsx(\"a\", {\n    className: \"bold text-uppercase\",\n    href: \"/register\",\n    onClick: goToRegister\n  }, \"Reg\\xEDstrate!\")), __jsx(_OrEnterWith.default, null), __jsx(_SocialButtons.default, {\n    socialLogin: socialLogin\n  })));\n};\n\nvar _default = LoginTab;\nexports.default = _default;","map":{"version":3,"sources":["/Users/rafael/Projects/somosgad/dale/components/layout/AuthModal/LoginTab.js"],"names":["LoginTab","changeTab","setLoading","socialLogin","email","setEmail","password","setPassword","error","setError","signIn","UserContext","closeAuthModal","code","socialProvider","AuthModalContext","providerLogin","_","pkg_int_id","package_id_intention","nookies","get","tokenResponse","post","client_id","CLIENT_ID","client_secret","CLIENT_SECRET","access_token","data","userResponse","console","table","handleSubmit","e","preventDefault","document","activeElement","blur","baseURL","grant_type","username","scope","response","status","message","log","goToPasswordRecovery","goToRegister","notRegistered","CONFIG","lang","target","value"],"mappings":"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","sourcesContent":["import { useContext, useState, useEffect } from 'react'\nimport UserContext from '../../../contexts/UserContext'\nimport api, { baseURL } from '../../../services/api'\nimport { CLIENT_ID, CLIENT_SECRET } from '../../../constants/constants'\nimport { setAccessToken } from '../../../services/auth'\nimport FormGroup from './FormGroup'\nimport Input from './Input'\nimport FormText from './FormText'\nimport Button from '../../button'\nimport { AuthModalContext } from '../../../contexts/AuthModalContext'\nimport nookies from 'nookies'\nimport SocialButtons from './SocialButtons'\nimport { CONFIG } from '~/config'\nimport OrEnterWith from './OrEnterWith'\n\nconst LoginTab = ({ changeTab, setLoading, socialLogin }) => {\n  const [ email, setEmail ] = useState('')\n  const [ password, setPassword ] = useState('')\n  const [ error, setError ] = useState('')\n  const { signIn } = useContext(UserContext)\n  const { closeAuthModal, code, socialProvider } = useContext(AuthModalContext)\n\n  const providerLogin = async _ => {\n    try{\n        setLoading(true);\n        const { pkg_int_id: package_id_intention } = nookies.get({}, 'pkg_int_id')\n        const tokenResponse = await api().post(`auth/${socialProvider}/callback`, {\n          code,\n          client_id: CLIENT_ID,\n          client_secret: CLIENT_SECRET,\n          package_id_intention\n        })\n\n        const { access_token } = tokenResponse.data\n        setAccessToken(access_token)\n        const userResponse = await api().get('/user')\n        setLoading(false)\n        signIn(userResponse.data, tokenResponse.data)\n        closeAuthModal()\n    } catch(error){\n      console.table(error);\n      setError('An error has occurred!')\n      setLoading(false)\n    }\n  }\n\n  useEffect(() => { if(code && socialProvider) providerLogin() }, [])\n\n  async function handleSubmit(e) {\n    e.preventDefault()\n    setLoading(true)\n    document.activeElement.blur()\n    try {\n      const tokenResponse = await api().post(`${baseURL}/oauth/token`, {\n        grant_type: 'password',\n        client_id: CLIENT_ID,\n        client_secret: CLIENT_SECRET,\n        username: email,\n        password,\n        scope: '',\n      })\n      const { access_token, } = tokenResponse.data\n      setAccessToken(access_token)\n      const userResponse = await api().get('/user')\n      signIn(userResponse.data, tokenResponse.data)\n      closeAuthModal()\n    } catch (error) {\n      if (error.response) {\n        const { data, status } = error.response\n        const message =\n          status === 400 ? 'Correo electrónico o contraseña incorrectos. Inténtalo de nuevo' :\n          status === 403 ? 'Tu dirección de correo electrónico no está verificada' :\n          status === 500 ? 'Servidor, base de datos o conexión no disponible' : data.message\n        setError(message)\n      } else {\n        setError('An error has occurred!')\n        console.log('error', error)\n      }\n    }\n    setLoading(false)\n  }\n\n  function goToPasswordRecovery(e) {\n    e.preventDefault()\n    changeTab('password')\n  }\n\n  function goToRegister(e) {\n    e.preventDefault()\n    changeTab('register')\n  }\n\n  const notRegistered = CONFIG.lang === 'es-CL' ? '¿No estás suscrito?' : '¿No es suscriptor?'\n\n  return (\n    <div>\n      <div className=\"intro-text\">\n        <p>¡Bienvenidos!</p>\n      </div>\n      <form method=\"post\"onSubmit={handleSubmit}>\n      {error && <div className=\"invalid-feedback\">{error}</div>}\n        <FormGroup>\n          <Input id=\"email\" autoComplete=\"username\" placeholder=\"E-mail\" onChange={e => setEmail(e.target.value)} required type=\"email\" value={email} />\n        </FormGroup>\n        <FormGroup>\n          <Input id=\"clave\" autoComplete=\"current-password\" placeholder=\"Clave\" onChange={e => setPassword(e.target.value)} required type=\"password\" value={password} />\n          <FormText>\n            <a href=\"#\" onClick={goToPasswordRecovery}>¿Olvidaste tu clave?</a>\n          </FormText>\n        </FormGroup>\n        <Button block className=\"enter-btn\" size=\"sm\" type=\"submit\">Entrar</Button>\n        <div className=\"already-subscriptor\">\n          <span>{notRegistered}</span>\n          {' '}\n          <a className=\"bold text-uppercase\" href=\"/register\" onClick={goToRegister}>Regístrate!</a>\n        </div>\n\n        <OrEnterWith />\n\n        <SocialButtons socialLogin={socialLogin} />\n\n      </form>\n    </div>\n  )\n}\n\nexport default LoginTab\n"]},"metadata":{},"sourceType":"script"}