{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { createContext, useState, useEffect } from 'react';\nimport Router from 'next/router';\nimport SafeJSONParse from 'json-parse-safe';\nimport nookies from 'nookies';\nimport api from '../services/api';\nimport { setAccessToken, removeAccessToken } from '../services/auth';\nvar UserContext = createContext();\nexport default UserContext;\nexport function UserProvider(_ref) {\n  _s();\n\n  var children = _ref.children;\n\n  var _nookies$get = nookies.get({}, 'user'),\n      userString = _nookies$get.user;\n\n  var userCookie = SafeJSONParse(userString).value;\n\n  var _useState = useState(userCookie),\n      user = _useState[0],\n      setUser = _useState[1];\n\n  var signIn = function signIn(user, tokenResponse) {\n    var access_token = tokenResponse.access_token,\n        expires_in = tokenResponse.expires_in,\n        refresh_token = tokenResponse.refresh_token,\n        token_type = tokenResponse.token_type;\n    setAccessToken(access_token);\n    localStorage.setItem('token_type', token_type);\n    localStorage.setItem('expires_in', expires_in);\n    localStorage.setItem('refresh_token', refresh_token);\n    localStorage.setItem('user', JSON.stringify(user));\n    nookies.set({}, 'user', JSON.stringify(user), {\n      path: '/'\n    });\n    setUser(user);\n\n    if (!user.register_completed_at) {\n      Router.replace('/success');\n    }\n  };\n\n  var signOut = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              api().post('logout').then(function (response) {\n                console.log('Logout successfully', response);\n                removeAccessToken();\n                localStorage.removeItem('token_type');\n                localStorage.removeItem('expires_in');\n                localStorage.removeItem('refresh_token');\n              })[\"catch\"](function (error) {\n                console.log(\"Couldn't logout\", error);\n              });\n              localStorage.removeItem('user');\n              nookies.destroy({}, 'user', {\n                path: '/'\n              });\n              setUser(null); // Router.push('/signin')\n              // location.href = location.protocol + '//' + location.host + location.pathname\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function signOut(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var updateUser = function updateUser(user) {\n    var userString = JSON.stringify(user);\n    localStorage.setItem('user', userString);\n    nookies.set({}, 'user', userString, {\n      path: '/'\n    });\n    setUser(user);\n  };\n\n  var completeUserProfile = function completeUserProfile(user) {};\n\n  return __jsx(UserContext.Provider, {\n    value: _objectSpread({}, {\n      user: user,\n      signIn: signIn,\n      signOut: signOut,\n      updateUser: updateUser\n    })\n  }, children);\n}\n\n_s(UserProvider, \"yEp+KvHNaDmq6BHjxTOl8YVnMy4=\");\n\n_c = UserProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"UserProvider\");","map":{"version":3,"sources":["/Users/rafael/Projects/somosgad/dale/contexts/UserContext.js"],"names":["createContext","useState","useEffect","Router","SafeJSONParse","nookies","api","setAccessToken","removeAccessToken","UserContext","UserProvider","children","get","userString","user","userCookie","value","setUser","signIn","tokenResponse","access_token","expires_in","refresh_token","token_type","localStorage","setItem","JSON","stringify","set","path","register_completed_at","replace","signOut","_","post","then","response","console","log","removeItem","error","destroy","updateUser","completeUserProfile"],"mappings":"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","sourcesContent":["import { createContext, useState, useEffect } from 'react'\n\nimport Router from 'next/router'\n\nimport SafeJSONParse from 'json-parse-safe'\nimport nookies from 'nookies'\n\nimport api from '../services/api'\nimport { setAccessToken, removeAccessToken } from '../services/auth'\n\nconst UserContext = createContext()\n\nexport default UserContext\n\nexport function UserProvider({ children }) {\n\n  const { user: userString } = nookies.get({}, 'user')\n  const userCookie = SafeJSONParse(userString).value\n  const [ user, setUser ] = useState(userCookie)\n\n  const signIn = (user, tokenResponse) => {\n\n    const {\n      access_token,\n      expires_in,\n      refresh_token,\n      token_type,\n    } = tokenResponse\n\n    setAccessToken(access_token)\n\n    localStorage.setItem('token_type', token_type)\n    localStorage.setItem('expires_in', expires_in)\n    localStorage.setItem('refresh_token', refresh_token)\n\n    localStorage.setItem('user', JSON.stringify(user))\n\n    nookies.set({}, 'user', JSON.stringify(user), { path: '/' })\n    \n    setUser(user)\n\n    if ( ! user.register_completed_at) {\n      Router.replace('/success')\n    }\n\n  }\n\n  const signOut = async _ => {\n\n    api().post('logout').then((response) => {\n      console.log('Logout successfully', response)\n      removeAccessToken()\n      localStorage.removeItem('token_type')\n      localStorage.removeItem('expires_in')\n      localStorage.removeItem('refresh_token')\n\n    }).catch((error) => {\n      console.log(\"Couldn't logout\", error)\n    })\n\n    localStorage.removeItem('user')\n    nookies.destroy({}, 'user', { path: '/' })\n    setUser(null)\n    // Router.push('/signin')\n    // location.href = location.protocol + '//' + location.host + location.pathname\n  }\n\n  const updateUser = user => {\n    const userString = JSON.stringify(user)\n    localStorage.setItem('user', userString)\n    nookies.set({}, 'user', userString, { path: '/' })\n    setUser(user)\n  }\n\n  const completeUserProfile = user => {\n\n\n\n  }\n\n  return (\n    <UserContext.Provider value={{...{ user, signIn, signOut, updateUser }}}>\n      {children}\n    </UserContext.Provider>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}