{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _s = $RefreshSig$();\n\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport Router from 'next/router';\nimport nookies from 'nookies';\nimport { useEffect, useState } from 'react';\nimport Button from '~/components/button';\nimport H2 from '~/components/h2';\nimport Layout from '~/components/layout/Layout';\nimport withAuth from '~/components/withAuth';\nimport { CONFIG } from '~/config';\n\nvar RegisterConfirmPage = function RegisterConfirmPage(_ref) {\n  _s();\n\n  var downloadLink = _ref.downloadLink,\n      layoutProps = _ref.layoutProps,\n      link = _ref.link;\n\n  var _useState = useState(10),\n      seconds = _useState[0],\n      setSeconds = _useState[1];\n\n  var _useState2 = useState(true),\n      timer = _useState2[0],\n      setTimer = _useState2[1];\n\n  useEffect(function (_) {\n    if (timer) {\n      var interval = setInterval(function (_) {\n        setSeconds(function (seconds) {\n          if (seconds - 1 <= 0) {\n            clearInterval(interval);\n            setTimer(false);\n            window.open(downloadLink, '_self');\n          }\n\n          return seconds - 1;\n        });\n      }, 1000);\n      return function (_) {\n        return clearInterval(interval);\n      };\n    }\n  }, [timer]);\n\n  function handleClick() {\n    setTimer(false);\n  }\n\n  return __jsx(Layout, layoutProps, __jsx(\"div\", {\n    className: \"jsx-469810096\" + \" \" + \"register-confirm container text-center\"\n  }, __jsx(\"h1\", {\n    className: \"jsx-469810096\"\n  }, \"Gracias\"), __jsx(H2, {\n    mb: 3,\n    uppercase: true\n  }, \"\\xA1Bienvenido a \", CONFIG.appName, \"!\"), __jsx(\"p\", {\n    className: \"jsx-469810096\" + \" \" + \"lead register-confirm__lead\"\n  }, timer ? __jsx(React.Fragment, null, \"El recibo bancario se descargar\\xE1 en \", seconds, \" segundos.\") : __jsx(React.Fragment, null, \"Si la descarga no se inici\\xF3 autom\\xE1ticamente,\", __jsx(\"br\", {\n    className: \"jsx-469810096\" + \" \" + \"d-none d-md-inline\"\n  }), \" h\\xE1z click en el bot\\xF3n de abajo.\")), __jsx(\"div\", {\n    className: \"jsx-469810096\" + \" \" + \"register-confirm__btn-container\"\n  }, __jsx(Button, {\n    href: link,\n    onClick: handleClick,\n    target: \"_blank\"\n  }, \"Abrir Recibo Bancario\")), !timer && __jsx(\"p\", {\n    className: \"jsx-469810096\" + \" \" + \"small register-confirm__small\"\n  }, \"Su plan se activar\\xE1 despu\\xE9s de la confirmaci\\xF3n del pago.\")), __jsx(_JSXStyle, {\n    id: \"469810096\"\n  }, \".register-confirm.jsx-469810096{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:100%;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;line-height:normal;padding-bottom:2.5%;}h1.jsx-469810096{color:var(--primary);}.register-confirm__lead.jsx-469810096{margin-bottom:30px;}.register-confirm__btn-container.jsx-469810096 .btn,.register-confirm__btn-container.jsx-469810096 .btn:active{border-bottom:5px solid var(--primary-hover);line-height:1;}.register-confirm__small.jsx-469810096{margin-top:30px;opacity:.5;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9yYWZhZWwvUHJvamVjdHMvc29tb3NnYWQvZGFsZS9wYWdlcy9yZWdpc3Rlci9jb25maXJtLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQTJEa0IsQUFHOEIsQUFTRSxBQUdGLEFBSTBCLEFBSTdCLGdCQUNMLEdBUmIsRUFIQSxNQVlBLGtCQUxnQixjQUNoQixrQ0FqQmUsMEVBQ1MsOEVBQ1YsWUFDVyxtR0FDSixtQkFDQyxvQkFDdEIiLCJmaWxlIjoiL1VzZXJzL3JhZmFlbC9Qcm9qZWN0cy9zb21vc2dhZC9kYWxlL3BhZ2VzL3JlZ2lzdGVyL2NvbmZpcm0uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUm91dGVyIGZyb20gJ25leHQvcm91dGVyJ1xuaW1wb3J0IG5vb2tpZXMgZnJvbSAnbm9va2llcydcbmltcG9ydCB7IHVzZUVmZmVjdCwgdXNlU3RhdGUgfSBmcm9tICdyZWFjdCdcbmltcG9ydCBCdXR0b24gZnJvbSAnfi9jb21wb25lbnRzL2J1dHRvbidcbmltcG9ydCBIMiBmcm9tICd+L2NvbXBvbmVudHMvaDInXG5pbXBvcnQgTGF5b3V0IGZyb20gJ34vY29tcG9uZW50cy9sYXlvdXQvTGF5b3V0J1xuaW1wb3J0IHdpdGhBdXRoIGZyb20gJ34vY29tcG9uZW50cy93aXRoQXV0aCdcbmltcG9ydCB7IENPTkZJRyB9IGZyb20gJ34vY29uZmlnJ1xuXG5jb25zdCBSZWdpc3RlckNvbmZpcm1QYWdlID0gKHsgZG93bmxvYWRMaW5rLCBsYXlvdXRQcm9wcywgbGluayB9KSA9PiB7XG5cbiAgY29uc3QgW3NlY29uZHMsIHNldFNlY29uZHNdID0gdXNlU3RhdGUoMTApXG4gIGNvbnN0IFt0aW1lciwgc2V0VGltZXJdID0gdXNlU3RhdGUodHJ1ZSlcblxuICB1c2VFZmZlY3QoXyA9PiB7XG4gICAgaWYgKHRpbWVyKSB7XG4gICAgICBjb25zdCBpbnRlcnZhbCA9IHNldEludGVydmFsKF8gPT4ge1xuICAgICAgICBzZXRTZWNvbmRzKHNlY29uZHMgPT4ge1xuICAgICAgICAgIGlmIChzZWNvbmRzIC0gMSA8PSAwKSB7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKGludGVydmFsKVxuICAgICAgICAgICAgc2V0VGltZXIoZmFsc2UpXG4gICAgICAgICAgICB3aW5kb3cub3Blbihkb3dubG9hZExpbmssICdfc2VsZicpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gc2Vjb25kcyAtIDFcbiAgICAgICAgfSlcbiAgICAgIH0sIDEwMDApXG4gICAgICByZXR1cm4gXyA9PiBjbGVhckludGVydmFsKGludGVydmFsKVxuICAgIH1cbiAgfSwgW3RpbWVyXSlcblxuICBmdW5jdGlvbiBoYW5kbGVDbGljaygpIHtcbiAgICBzZXRUaW1lcihmYWxzZSlcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgPExheW91dCB7Li4ubGF5b3V0UHJvcHN9PlxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJyZWdpc3Rlci1jb25maXJtIGNvbnRhaW5lciB0ZXh0LWNlbnRlclwiPlxuXG4gICAgICAgIDxoMT5HcmFjaWFzPC9oMT5cblxuICAgICAgICA8SDIgbWI9ezN9IHVwcGVyY2FzZT7CoUJpZW52ZW5pZG8gYSB7Q09ORklHLmFwcE5hbWV9ITwvSDI+XG5cbiAgICAgICAgPHAgY2xhc3NOYW1lPVwibGVhZCByZWdpc3Rlci1jb25maXJtX19sZWFkXCI+XG4gICAgICAgICAge3RpbWVyID8gPD5cbiAgICAgICAgICAgIEVsIHJlY2libyBiYW5jYXJpbyBzZSBkZXNjYXJnYXLDoSBlbiB7c2Vjb25kc30gc2VndW5kb3MuXG4gICAgICAgICAgPC8+IDogPD5cbiAgICAgICAgICAgIFNpIGxhIGRlc2NhcmdhIG5vIHNlIGluaWNpw7MgYXV0b23DoXRpY2FtZW50ZSw8YnIgY2xhc3NOYW1lPVwiZC1ub25lIGQtbWQtaW5saW5lXCIgLz4gaMOheiBjbGljayBlbiBlbCBib3TDs24gZGUgYWJham8uXG4gICAgICAgICAgPC8+fVxuICAgICAgICA8L3A+XG5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJyZWdpc3Rlci1jb25maXJtX19idG4tY29udGFpbmVyXCI+XG4gICAgICAgICAgPEJ1dHRvbiBocmVmPXtsaW5rfSBvbkNsaWNrPXtoYW5kbGVDbGlja30gdGFyZ2V0PVwiX2JsYW5rXCI+QWJyaXIgUmVjaWJvIEJhbmNhcmlvPC9CdXR0b24+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIHshdGltZXIgJiYgKFxuICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInNtYWxsIHJlZ2lzdGVyLWNvbmZpcm1fX3NtYWxsXCI+U3UgcGxhbiBzZSBhY3RpdmFyw6EgZGVzcHXDqXMgZGUgbGEgY29uZmlybWFjacOzbiBkZWwgcGFnby48L3A+XG4gICAgICAgICl9XG5cbiAgICAgIDwvZGl2PlxuICAgICAgPHN0eWxlIGpzeD57YFxuICAgICAgICAucmVnaXN0ZXItY29uZmlybSB7XG4gICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gICAgICAgICAgaGVpZ2h0OiAxMDAlO1xuICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICAgICAgICAgIGxpbmUtaGVpZ2h0OiBub3JtYWw7XG4gICAgICAgICAgcGFkZGluZy1ib3R0b206IDIuNSU7XG4gICAgICAgIH1cbiAgICAgICAgaDEge1xuICAgICAgICAgIGNvbG9yOiB2YXIoLS1wcmltYXJ5KTtcbiAgICAgICAgfVxuICAgICAgICAucmVnaXN0ZXItY29uZmlybV9fbGVhZCB7XG4gICAgICAgICAgbWFyZ2luLWJvdHRvbTogMzBweDtcbiAgICAgICAgfVxuICAgICAgICAucmVnaXN0ZXItY29uZmlybV9fYnRuLWNvbnRhaW5lciA6Z2xvYmFsKC5idG4pLFxuICAgICAgICAucmVnaXN0ZXItY29uZmlybV9fYnRuLWNvbnRhaW5lciA6Z2xvYmFsKC5idG4pOmFjdGl2ZSB7XG4gICAgICAgICAgYm9yZGVyLWJvdHRvbTogNXB4IHNvbGlkIHZhcigtLXByaW1hcnktaG92ZXIpO1xuICAgICAgICAgIGxpbmUtaGVpZ2h0OiAxO1xuICAgICAgICB9XG4gICAgICAgIC5yZWdpc3Rlci1jb25maXJtX19zbWFsbCB7XG4gICAgICAgICAgbWFyZ2luLXRvcDogMzBweDtcbiAgICAgICAgICBvcGFjaXR5OiAuNTtcbiAgICAgICAgfVxuICAgICAgYH08L3N0eWxlPlxuICAgIDwvTGF5b3V0PlxuICApXG59XG5cblJlZ2lzdGVyQ29uZmlybVBhZ2UuZ2V0SW5pdGlhbFByb3BzID0gYXN5bmMgY3R4ID0+IHtcblxuICBjb25zdCB7YXBpLCBxdWVyeSwgcmVzLCB1c2VyfSA9IGN0eFxuXG4gIC8vIGlmIHRoZSB1c2VyIGhhc24ndCBjb21wbGV0ZWQgdGhlIHJlZ2lzdHJ5XG4gIGlmICghdXNlci5yZWdpc3Rlcl9jb21wbGV0ZWRfYXQpIHtcbiAgICBjb25zdCBtZXNzYWdlID0gSlNPTi5zdHJpbmdpZnkoeyBpbmZvOiAnTmVjZXNpdGFzIGNvbXBsZXRhciB0dSByZWdpc3Ryby4nIH0pXG4gICAgbm9va2llcy5zZXQoY3R4LCAnZmxhc2hfbWVzc2FnZScsIG1lc3NhZ2UsIHsgcGF0aDogJy8nIH0pXG4gICAgaWYgKHJlcykge1xuICAgICAgcmVzLnJlZGlyZWN0KCcvcmVnaXN0ZXIvY29tcGxldGUnKVxuICAgICAgcmVzLmVuZCgpXG4gICAgICByZXR1cm4ge31cbiAgICB9IGVsc2Uge1xuICAgICAgUm91dGVyLmJhY2soKVxuICAgIH1cbiAgfVxuXG4gIC8vIGdldCBkb3dubG9hZF9saW5rIGFuZCBsaW5rIGZyb20gcm91dGVyIHF1ZXJ5IGlmIGl0IGNvbWVzXG4gIGxldCB7ZG93bmxvYWRfbGluazogZG93bmxvYWRMaW5rLCBsaW5rfSA9IHF1ZXJ5XG5cbiAgLy8gaWYgaXQgZG9lc24ndCBjb21lLCB0cnkgdG8gZ2V0IHRoZSBsYXN0IGNhc2ggb3JkZXJcbiAgaWYgKCFkb3dubG9hZExpbmsgfHwgIWxpbmspIHtcbiAgICBjb25zdCB7ZGF0YTogY2FzaE9yZGVyfSA9IGF3YWl0IGFwaS5nZXQoJ2Nhc2gtb3JkZXJzL2xhc3QnKTtcblxuICAgIC8vIGlmIG5vIHBlbmRpbmcgY2FzaCBvcmRlciBpcyBmb3VuZCwgcmVkaXJlY3QgdG8gdXNlciBhY2NvdW50XG4gICAgaWYgKCFjYXNoT3JkZXIpIHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBKU09OLnN0cmluZ2lmeSh7IGluZm86ICdObyB0aWVuZSByZWNpYm9zIGJhbmNhcmlvcyBhYmllcnRvcy4nIH0pXG4gICAgICBub29raWVzLnNldChjdHgsICdmbGFzaF9tZXNzYWdlJywgbWVzc2FnZSwgeyBwYXRoOiAnLycgfSlcbiAgICAgIGlmIChyZXMpIHtcbiAgICAgICAgcmVzLnJlZGlyZWN0KCcvdXNlci9hY2NvdW50JylcbiAgICAgICAgcmVzLmVuZCgpXG4gICAgICAgIHJldHVybiB7fVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgUm91dGVyLmJhY2soKVxuICAgICAgfVxuICAgIH1cblxuICAgIGRvd25sb2FkTGluayA9IGNhc2hPcmRlci5kb3dubG9hZF9saW5rXG4gICAgbGluayA9IGNhc2hPcmRlci5saW5rXG4gIH1cblxuICByZXR1cm4ge2Rvd25sb2FkTGluaywgbGlua31cbn1cblxuZXhwb3J0IGRlZmF1bHQgd2l0aEF1dGgoUmVnaXN0ZXJDb25maXJtUGFnZSwgdHJ1ZSlcbiJdfQ== */\\n/*@ sourceURL=/Users/rafael/Projects/somosgad/dale/pages/register/confirm.js */\"));\n};\n\n_s(RegisterConfirmPage, \"tgblMgMg34KsVHInFsPEo096g1I=\");\n\n_c = RegisterConfirmPage;\n\nRegisterConfirmPage.getInitialProps = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(ctx) {\n    var api, query, res, user, message, downloadLink, link, _yield$api$get, cashOrder, _message;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            api = ctx.api, query = ctx.query, res = ctx.res, user = ctx.user; // if the user hasn't completed the registry\n\n            if (user.register_completed_at) {\n              _context.next = 11;\n              break;\n            }\n\n            message = JSON.stringify({\n              info: 'Necesitas completar tu registro.'\n            });\n            nookies.set(ctx, 'flash_message', message, {\n              path: '/'\n            });\n\n            if (!res) {\n              _context.next = 10;\n              break;\n            }\n\n            res.redirect('/register/complete');\n            res.end();\n            return _context.abrupt(\"return\", {});\n\n          case 10:\n            Router.back();\n\n          case 11:\n            // get download_link and link from router query if it comes\n            downloadLink = query.download_link, link = query.link; // if it doesn't come, try to get the last cash order\n\n            if (!(!downloadLink || !link)) {\n              _context.next = 29;\n              break;\n            }\n\n            _context.next = 15;\n            return api.get('cash-orders/last');\n\n          case 15:\n            _yield$api$get = _context.sent;\n            cashOrder = _yield$api$get.data;\n\n            if (cashOrder) {\n              _context.next = 27;\n              break;\n            }\n\n            _message = JSON.stringify({\n              info: 'No tiene recibos bancarios abiertos.'\n            });\n            nookies.set(ctx, 'flash_message', _message, {\n              path: '/'\n            });\n\n            if (!res) {\n              _context.next = 26;\n              break;\n            }\n\n            res.redirect('/user/account');\n            res.end();\n            return _context.abrupt(\"return\", {});\n\n          case 26:\n            Router.back();\n\n          case 27:\n            downloadLink = cashOrder.download_link;\n            link = cashOrder.link;\n\n          case 29:\n            return _context.abrupt(\"return\", {\n              downloadLink: downloadLink,\n              link: link\n            });\n\n          case 30:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexport default _c2 = withAuth(RegisterConfirmPage, true);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"RegisterConfirmPage\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["/Users/rafael/Projects/somosgad/dale/pages/register/confirm.js"],"names":["Router","nookies","useEffect","useState","Button","H2","Layout","withAuth","CONFIG","RegisterConfirmPage","downloadLink","layoutProps","link","seconds","setSeconds","timer","setTimer","_","interval","setInterval","clearInterval","window","open","handleClick","appName","getInitialProps","ctx","api","query","res","user","register_completed_at","message","JSON","stringify","info","set","path","redirect","end","back","download_link","get","cashOrder","data"],"mappings":"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","sourcesContent":["import Router from 'next/router'\nimport nookies from 'nookies'\nimport { useEffect, useState } from 'react'\nimport Button from '~/components/button'\nimport H2 from '~/components/h2'\nimport Layout from '~/components/layout/Layout'\nimport withAuth from '~/components/withAuth'\nimport { CONFIG } from '~/config'\n\nconst RegisterConfirmPage = ({ downloadLink, layoutProps, link }) => {\n\n  const [seconds, setSeconds] = useState(10)\n  const [timer, setTimer] = useState(true)\n\n  useEffect(_ => {\n    if (timer) {\n      const interval = setInterval(_ => {\n        setSeconds(seconds => {\n          if (seconds - 1 <= 0) {\n            clearInterval(interval)\n            setTimer(false)\n            window.open(downloadLink, '_self');\n          }\n          return seconds - 1\n        })\n      }, 1000)\n      return _ => clearInterval(interval)\n    }\n  }, [timer])\n\n  function handleClick() {\n    setTimer(false)\n  }\n\n  return (\n    <Layout {...layoutProps}>\n      <div className=\"register-confirm container text-center\">\n\n        <h1>Gracias</h1>\n\n        <H2 mb={3} uppercase>¡Bienvenido a {CONFIG.appName}!</H2>\n\n        <p className=\"lead register-confirm__lead\">\n          {timer ? <>\n            El recibo bancario se descargará en {seconds} segundos.\n          </> : <>\n            Si la descarga no se inició automáticamente,<br className=\"d-none d-md-inline\" /> ház click en el botón de abajo.\n          </>}\n        </p>\n\n        <div className=\"register-confirm__btn-container\">\n          <Button href={link} onClick={handleClick} target=\"_blank\">Abrir Recibo Bancario</Button>\n        </div>\n\n        {!timer && (\n          <p className=\"small register-confirm__small\">Su plan se activará después de la confirmación del pago.</p>\n        )}\n\n      </div>\n      <style jsx>{`\n        .register-confirm {\n          align-items: center;\n          display: flex;\n          flex-direction: column;\n          height: 100%;\n          justify-content: center;\n          line-height: normal;\n          padding-bottom: 2.5%;\n        }\n        h1 {\n          color: var(--primary);\n        }\n        .register-confirm__lead {\n          margin-bottom: 30px;\n        }\n        .register-confirm__btn-container :global(.btn),\n        .register-confirm__btn-container :global(.btn):active {\n          border-bottom: 5px solid var(--primary-hover);\n          line-height: 1;\n        }\n        .register-confirm__small {\n          margin-top: 30px;\n          opacity: .5;\n        }\n      `}</style>\n    </Layout>\n  )\n}\n\nRegisterConfirmPage.getInitialProps = async ctx => {\n\n  const {api, query, res, user} = ctx\n\n  // if the user hasn't completed the registry\n  if (!user.register_completed_at) {\n    const message = JSON.stringify({ info: 'Necesitas completar tu registro.' })\n    nookies.set(ctx, 'flash_message', message, { path: '/' })\n    if (res) {\n      res.redirect('/register/complete')\n      res.end()\n      return {}\n    } else {\n      Router.back()\n    }\n  }\n\n  // get download_link and link from router query if it comes\n  let {download_link: downloadLink, link} = query\n\n  // if it doesn't come, try to get the last cash order\n  if (!downloadLink || !link) {\n    const {data: cashOrder} = await api.get('cash-orders/last');\n\n    // if no pending cash order is found, redirect to user account\n    if (!cashOrder) {\n      const message = JSON.stringify({ info: 'No tiene recibos bancarios abiertos.' })\n      nookies.set(ctx, 'flash_message', message, { path: '/' })\n      if (res) {\n        res.redirect('/user/account')\n        res.end()\n        return {}\n      } else {\n        Router.back()\n      }\n    }\n\n    downloadLink = cashOrder.download_link\n    link = cashOrder.link\n  }\n\n  return {downloadLink, link}\n}\n\nexport default withAuth(RegisterConfirmPage, true)\n"]},"metadata":{},"sourceType":"module"}