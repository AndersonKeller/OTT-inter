{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport shaka from 'shaka-player/dist/shaka-player.ui.js'; // no SSR support\n\nimport { IS_PRODUCTION } from '~/constants/constants';\n\nvar ShakaPlayer = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(ShakaPlayer, _React$PureComponent);\n\n  var _super = _createSuper(ShakaPlayer);\n\n  function ShakaPlayer(props) {\n    var _this;\n\n    _classCallCheck(this, ShakaPlayer);\n\n    _this = _super.call(this, props);\n    _this.autoPlay = _this.props.autoPlay || true;\n    _this.videoComponent = React.createRef();\n    _this.videoContainer = React.createRef();\n    _this.onErrorEvent = _this.onErrorEvent.bind(_assertThisInitialized(_this));\n    _this.onError = _this.onError.bind(_assertThisInitialized(_this));\n    _this.media = _this.props.media;\n    _this.poster = _this.props.poster ? _this.props.poster : null;\n    _this.height = _this.props.height ? _this.props.height : 400;\n    _this.width = _this.props.width ? _this.props.width : 600;\n    return _this;\n  }\n\n  _createClass(ShakaPlayer, [{\n    key: \"onErrorEvent\",\n    value: function onErrorEvent(event) {\n      this.onError(event.detail);\n    }\n  }, {\n    key: \"onError\",\n    value: function onError(error) {\n      console.error('Error code', error.code, 'object', error);\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      // Install built-in polyfills to patch browser incompatibilities.\n      shaka.polyfill.installAll(); // Check to see if the browser supports the basic APIs Shaka needs.\n\n      if (shaka.Player.isBrowserSupported()) {\n        // Everything looks good!\n        this.initPlayer();\n      } else {\n        // This browser does not have the minimum set of APIs we need.\n        console.error('Browser not supported!');\n      }\n    }\n  }, {\n    key: \"initPlayer\",\n    value: function () {\n      var _initPlayer = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var video, videoContainer, player, minutes, bufferingGoal, ui, uiConfig, hls_type_id, mpd_type_id, hls_link, mpd_link, support, manifestUri;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                // Create a Player instance.\n                video = this.videoComponent.current;\n                videoContainer = this.videoContainer.current;\n                player = new shaka.Player(video); // player language configurations\n\n                player.configure('preferredTextLanguage', 'es');\n                player.configure('preferredAudioLanguage', 'es');\n                minutes = 10;\n                bufferingGoal = 60 * minutes;\n                player.configure('streaming.bufferingGoal', bufferingGoal); //Setting up shaka player UI\n\n                ui = new shaka.ui.Overlay(player, videoContainer, video);\n                ui.getControls();\n                uiConfig = {\n                  addBigPlayButton: false,\n                  controlPanelElements: ['play_pause', 'time_and_duration', 'spacer', 'mute', 'volume', 'fullscreen', 'overflow_menu'],\n                  overflowMenuButtons: ['cast', 'quality', 'picture_in_picture']\n                };\n                ui.configure(uiConfig); // Listen for error events.\n\n                player.addEventListener('error', this.onErrorEvent); // Determine if it must load mpd or hls\n\n                hls_type_id = 1;\n                mpd_type_id = 2;\n                hls_link = this.media ? this.media.movie_links.find(function (element) {\n                  return element.movie_link_type_id === hls_type_id;\n                }) : null;\n                mpd_link = this.media ? this.media.movie_links.find(function (element) {\n                  return element.movie_link_type_id === mpd_type_id;\n                }) : null;\n                _context.next = 19;\n                return shaka.Player.probeSupport();\n\n              case 19:\n                support = _context.sent;\n                manifestUri = support.manifest.mpd && mpd_link ? mpd_link.url : hls_link ? hls_link.url : null;\n                /* esse funciona: */\n                // const manifestUri = 'https://s3-us-west-1.amazonaws.com/videos.in/dale/dash/la+copa+eterna.mpd'\n\n                /* esses non: */\n                // const manifestUri = 'https://story-video-out.s3-us-west-1.amazonaws.com/teste/DASHIndex.mpd'\n                // const manifestUri = 'https://story-video-out.s3-us-west-1.amazonaws.com/teste/HLSIndex.m3u8'\n\n                console.log('Suporta ' + (support.manifest.mpd ? 'mpd' : 'hls'), manifestUri); // Try to load a manifest.\n                // This is an asynchronous process.\n\n                player.load(manifestUri).then(function () {\n                  // This runs if the asynchronous load is successful.\n                  console.log('The video has now been loaded!');\n                })[\"catch\"](this.onError); // onError is executed if the asynchronous load fails.\n\n              case 23:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function initPlayer() {\n        return _initPlayer.apply(this, arguments);\n      }\n\n      return initPlayer;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      return __jsx(\"div\", {\n        ref: this.videoContainer,\n        className: \"jsx-2162939282\" + \" \" + \"video-container\"\n      }, __jsx(\"video\", {\n        autoPlay: this.autoPlay,\n        height: this.height,\n        muted: !IS_PRODUCTION,\n        poster: this.poster,\n        ref: this.videoComponent,\n        style: {\n          outline: 0\n        },\n        width: this.width,\n        className: \"jsx-2162939282\" + \" \" + 'video-player'\n      }), __jsx(_JSXStyle, {\n        id: \"2162939282\"\n      }, [\".video-container.jsx-2162939282 .shaka-bottom-controls{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}\", \".video-container.jsx-2162939282 .shaka-bottom-controls .shaka-controls-button-panel{-webkit-order:2;-ms-flex-order:2;order:2;width:100%;}\", \".video-container.jsx-2162939282 .shaka-bottom-controls .shaka-seek-bar-container{-webkit-order:1;-ms-flex-order:1;order:1;width:100%;}\"]));\n    }\n  }]);\n\n  return ShakaPlayer;\n}(React.PureComponent);\n\nexport default ShakaPlayer;","map":{"version":3,"sources":["/Users/rafael/Projects/somosgad/dale/components/Player/ShakaPlayer.js"],"names":["React","shaka","IS_PRODUCTION","ShakaPlayer","props","autoPlay","videoComponent","createRef","videoContainer","onErrorEvent","bind","onError","media","poster","height","width","event","detail","error","console","code","polyfill","installAll","Player","isBrowserSupported","initPlayer","video","current","player","configure","minutes","bufferingGoal","ui","Overlay","getControls","uiConfig","addBigPlayButton","controlPanelElements","overflowMenuButtons","addEventListener","hls_type_id","mpd_type_id","hls_link","movie_links","find","element","movie_link_type_id","mpd_link","probeSupport","support","manifestUri","manifest","mpd","url","log","load","then","outline","PureComponent"],"mappings":"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","sourcesContent":["import React from 'react'\nimport shaka from 'shaka-player/dist/shaka-player.ui.js' // no SSR support\nimport { IS_PRODUCTION } from '~/constants/constants'\n\nclass ShakaPlayer extends React.PureComponent\n{\n  constructor(props) {\n    super(props)\n    this.autoPlay = this.props.autoPlay || true\n    this.videoComponent = React.createRef()\n    this.videoContainer = React.createRef()\n    this.onErrorEvent = this.onErrorEvent.bind(this)\n    this.onError = this.onError.bind(this)\n    this.media = this.props.media\n    this.poster = this.props.poster ? this.props.poster : null\n    this.height = this.props.height ? this.props.height : 400\n    this.width = this.props.width ? this.props.width : 600\n  }\n\n  onErrorEvent(event) {\n    this.onError(event.detail)\n  }\n\n  onError(error) {\n    console.error('Error code', error.code, 'object', error)\n  }\n\n  componentDidMount(){\n    // Install built-in polyfills to patch browser incompatibilities.\n    shaka.polyfill.installAll()\n\n    // Check to see if the browser supports the basic APIs Shaka needs.\n    if (shaka.Player.isBrowserSupported()) {\n      // Everything looks good!\n      this.initPlayer()\n    } else {\n      // This browser does not have the minimum set of APIs we need.\n      console.error('Browser not supported!')\n    }\n  }\n\n  async initPlayer() {\n    // Create a Player instance.\n    const video = this.videoComponent.current\n    const videoContainer = this.videoContainer.current\n    var player = new shaka.Player(video)\n\n    // player language configurations\n    player.configure('preferredTextLanguage', 'es')\n    player.configure('preferredAudioLanguage', 'es')\n    const minutes = 10\n    const bufferingGoal = 60 * minutes\n    player.configure('streaming.bufferingGoal', bufferingGoal)\n\n\t\t//Setting up shaka player UI\n    const ui = new shaka.ui.Overlay(player, videoContainer, video)\n    ui.getControls()\n    const uiConfig = {\n      addBigPlayButton: false,\n      controlPanelElements: [\n        'play_pause', 'time_and_duration', 'spacer', 'mute', 'volume', 'fullscreen', 'overflow_menu',\n      ],\n      overflowMenuButtons: ['cast', 'quality', 'picture_in_picture'],\n    }\n    ui.configure(uiConfig)\n\n    // Listen for error events.\n    player.addEventListener('error', this.onErrorEvent)\n\n    // Determine if it must load mpd or hls\n    const hls_type_id = 1\n    const mpd_type_id = 2\n    const hls_link = this.media ? this.media.movie_links.find(element => {\n      return element.movie_link_type_id === hls_type_id\n    }) : null\n    const mpd_link = this.media ? this.media.movie_links.find(element => {\n      return element.movie_link_type_id === mpd_type_id\n    }) : null\n    const support = await shaka.Player.probeSupport();\n    const manifestUri = support.manifest.mpd && mpd_link ? mpd_link.url :\n      hls_link ? hls_link.url : null\n\n    /* esse funciona: */\n    // const manifestUri = 'https://s3-us-west-1.amazonaws.com/videos.in/dale/dash/la+copa+eterna.mpd'\n\n    /* esses non: */\n    // const manifestUri = 'https://story-video-out.s3-us-west-1.amazonaws.com/teste/DASHIndex.mpd'\n    // const manifestUri = 'https://story-video-out.s3-us-west-1.amazonaws.com/teste/HLSIndex.m3u8'\n\n    console.log('Suporta ' + (support.manifest.mpd ? 'mpd' : 'hls'), manifestUri)\n\n    // Try to load a manifest.\n    // This is an asynchronous process.\n    player.load(manifestUri).then(function() {\n      // This runs if the asynchronous load is successful.\n      console.log('The video has now been loaded!')\n    }).catch(this.onError)  // onError is executed if the asynchronous load fails.\n  }\n\n  render() {\n    return (\n      <div className=\"video-container\" ref={this.videoContainer}>\n        <video\n          autoPlay={this.autoPlay}\n          className='video-player'\n          height={this.height}\n          muted={!IS_PRODUCTION}\n          poster={this.poster}\n          ref={this.videoComponent}\n          style={{ outline: 0 }}\n          width={this.width}\n        />\n        <style jsx>{`\n          .video-container :global(.shaka-bottom-controls) {\n            display: flex;\n            flex-direction: column;\n          }\n          .video-container :global(.shaka-bottom-controls .shaka-controls-button-panel) {\n            order: 2;\n            width: 100%;\n          }\n          .video-container :global(.shaka-bottom-controls .shaka-seek-bar-container) {\n            order: 1;\n            width: 100%;\n          }\n        `}</style>\n      </div>\n    )\n  }\n}\n\nexport default ShakaPlayer\n"]},"metadata":{},"sourceType":"module"}