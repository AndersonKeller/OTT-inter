{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _react = require(\"react\");\n\nvar _FormGroup = _interopRequireDefault(require(\"~/components/layout/AuthModal/FormGroup\"));\n\nvar _Label = _interopRequireDefault(require(\"~/components/Form/Label\"));\n\nvar _Input = _interopRequireDefault(require(\"~/components/layout/AuthModal/Input\"));\n\nvar _InputRadio = _interopRequireDefault(require(\"~/components/Form/InputRadio\"));\n\nvar _withAuth = _interopRequireDefault(require(\"~/components/withAuth\"));\n\nvar _InvalidFeedback = _interopRequireDefault(require(\"~/components/Form/InvalidFeedback\"));\n\nvar _constants = require(\"~/constants/constants\");\n\nvar _useScript = _interopRequireDefault(require(\"@charlietango/use-script\"));\n\nvar _Select = _interopRequireDefault(require(\"~/components/Select/Select\"));\n\nvar _button = _interopRequireDefault(require(\"~/components/button\"));\n\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nconst IMaskInput = require('react-imask').IMaskInput; // import {IMaskInput} from 'react-imask';\n\n\nconst Payment = ({\n  layoutProps,\n  userData,\n  package_id,\n  packages,\n  api,\n  error,\n  requireds\n}) => {\n  const [ready, status] = (0, _useScript.default)('https://secure.mlstatic.com/sdk/javascript/v1/mercadopago.js');\n  let selectedPackage = null;\n\n  if (packages && package_id) {\n    selectedPackage = packages.items.find(i => i.id == package_id);\n    console.log(selectedPackage);\n  }\n\n  const {\n    0: values,\n    1: setValues\n  } = (0, _react.useState)({\n    package_id: '',\n    payment_method_id: null,\n    payment_os: null,\n    cash_payment_method_id: null,\n    terms: null,\n    discount_id: null,\n    credit_card_number: null,\n    due_date: null\n  });\n  const {\n    0: cardImg,\n    1: setCardImg\n  } = (0, _react.useState)(null);\n  const {\n    0: creditCard,\n    1: setCreditCard\n  } = (0, _react.useState)(null);\n  const {\n    0: loading,\n    1: setLoading\n  } = (0, _react.useState)();\n  const businessUnitPublicKey = 'TEST-7205c1be-9805-4308-bf00-6557c5b56b88';\n  const {\n    0: isMercadoPagoReady,\n    1: setIsMercadoPagoReady\n  } = (0, _react.useState)(false);\n  const MercadoPago = ready && _constants.HAS_WINDOW ? window.Mercadopago : null;\n  const credit_card_id = 1;\n  const debit_card_id = 2;\n  const isCardPayment = [credit_card_id, debit_card_id].includes(values.payment_method_id);\n  (0, _react.useEffect)(_ => {\n    if (MercadoPago) {\n      MercadoPago.setPublishableKey(businessUnitPublicKey);\n      setIsMercadoPagoReady(true);\n    }\n  }, [MercadoPago]);\n  /* handle payment method change */\n\n  function onPaymentChange(e) {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      payment_method_id: parseInt(e.target.value, 10),\n      cash_payment_method_id: null\n    }));\n  }\n\n  function onCashPaymentMethodChange(e) {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      cash_payment_method_id: parseInt(e.target.value, 10)\n    }));\n  }\n\n  const handleInputChange = e => {\n    const {\n      checked,\n      name,\n      value,\n      type\n    } = e.target;\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      [name]: type === 'checkbox' ? checked ? value === 'true' ? true : value : false : value\n    }));\n  };\n\n  const handleInputChangeCreditCardNumber = e => {\n    const {\n      name,\n      value\n    } = e.target;\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      [name]: value\n    }));\n    let cardnumber = value;\n\n    if (cardnumber.length >= 6) {\n      let bin = cardnumber.substring(0, 6);\n      MercadoPago.getPaymentMethod({\n        \"bin\": bin\n      }, (status, details) => {\n        setCardImg(details[0].secure_thumbnail);\n        setCreditCard(details[0]);\n      });\n    }\n  }; // payment methods\n\n\n  const {\n    0: paymentMethods,\n    1: setPaymentMethods\n  } = (0, _react.useState)(); // get payment methods\n\n  (0, _react.useEffect)(_ => {\n    const getPaymentMethods = async _ => {\n      const {\n        data\n      } = await api.get('payment-methods');\n      setPaymentMethods(data);\n    };\n\n    getPaymentMethods();\n  }, []); // init card secure fields\n\n  (0, _react.useEffect)(_ => {\n    if (isMercadoPagoReady && isCardPayment) {\n      MercadoPago.initSecureFields('card-secure-fields');\n    }\n  }, [isMercadoPagoReady, isCardPayment]); // cash payment methods\n\n  const {\n    0: cashPaymentMethods,\n    1: setCashPaymentMethods\n  } = (0, _react.useState)(); // get cash payment methods\n\n  (0, _react.useEffect)(_ => {\n    const getCashPaymentMethods = async _ => {\n      const {\n        data\n      } = await api.get('cash-payment-methods');\n      setCashPaymentMethods(data);\n    };\n\n    getCashPaymentMethods();\n  }, []);\n  /* token */\n\n  async function createToken() {\n    const promise = new Promise((resolve, reject) => {\n      const additionalData = {\n        holder_name: document.getElementById('cardholder-name').value // custom_data: document.getElementById('custom').value,\n\n      };\n      MercadoPago.createToken(additionalData, result => {\n        const json = JSON.parse(result);\n        console.log('json', json);\n        json.token ? resolve(json) : reject(json);\n      });\n    });\n    return promise;\n  }\n\n  const submitCredit = async e => {\n    e.preventDefault();\n    setLoading(true);\n    const paymentData = values.package_id && values.payment_method_id && isCardPayment ? await createToken() : null;\n\n    const data = _objectSpread(_objectSpread({}, values), {}, {\n      payment_os: paymentData\n    });\n\n    try {\n      const res = await api.post(`register/subscribe`, {\n        package_id: package_id,\n        payment_method_id: values.payment_method_id,\n        token: \"\"\n      }); // handleSubmit(1)\n    } catch (error) {\n      if (error.response) {\n        const {\n          data,\n          status\n        } = error.response;\n\n        if (status === 422) {\n          setError(data);\n        }\n      } else if (error.request) {\n        setError(error);\n      } else {\n        setError(error);\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return __jsx(\"div\", {\n    className: \"row\"\n  }, __jsx(\"div\", {\n    className: \"offset-md-2 col-md-8\"\n  }, __jsx(\"h3\", {\n    className: \"h3\"\n  }, \"Pago\"), __jsx(\"div\", {\n    className: \"row\"\n  }, __jsx(\"div\", {\n    className: \"col-md-6 paymentMethod\"\n  }, __jsx(\"div\", {\n    className: \"row\"\n  }, __jsx(\"div\", {\n    className: \"col-12\"\n  }, __jsx(_FormGroup.default, null, __jsx(_Label.default, {\n    htmlFor: \"payment_method_id\",\n    style: \"margin: 0;\"\n  }, \"Pague com\"), __jsx(_Select.default, {\n    id: \"payment_method_id\",\n    name: \"payment_method_id\",\n    required: requireds,\n    onChange: onPaymentChange,\n    value: values.payment_method_id\n  }, __jsx(\"option\", {\n    value: \"0\"\n  }, \"Selecione\"), paymentMethods && paymentMethods.map((paymentMethod, key) => __jsx(\"option\", {\n    key: paymentMethod.id,\n    state: values.payment_method_id,\n    value: paymentMethod.id\n  }, paymentMethod.name))), __jsx(_InvalidFeedback.default, {\n    error: error,\n    loading: loading,\n    name: \"gender_id\"\n  }))), __jsx(\"div\", {\n    className: \"col-12\"\n  }, __jsx(_FormGroup.default, null, __jsx(_Label.default, {\n    htmlFor: \"cardholder-name\"\n  }, \"Nombre impreso en tarjeta\"), __jsx(_Input.default, {\n    id: \"cardholder-name\",\n    name: \"cardholder-name\",\n    required: requireds,\n    type: \"text\",\n    onChange: handleInputChange\n  }))), __jsx(\"div\", {\n    className: \"col-12\"\n  }, __jsx(_FormGroup.default, null, __jsx(_Label.default, {\n    htmlFor: \"card-number\"\n  }, \"Nro Cart\\xE3o\"), __jsx(\"img\", {\n    src: cardImg,\n    class: \"creditCardBrand\"\n  }), __jsx(_Input.default, {\n    id: \"card-number\",\n    name: \"card-number\",\n    value: values.credit_card_number,\n    required: requireds,\n    type: \"text\",\n    onChange: handleInputChangeCreditCardNumber,\n    maxLength: 19\n  }))), __jsx(\"div\", {\n    className: \"col-6\"\n  }, __jsx(_FormGroup.default, null, __jsx(_Label.default, {\n    htmlFor: \"card-duedate\"\n  }, \"Dt Vencimento\"))), __jsx(\"div\", {\n    className: \"col-6\"\n  }, __jsx(_FormGroup.default, null, __jsx(_Label.default, {\n    htmlFor: \"card-cvv\"\n  }, \"CVV\"), __jsx(IMaskInput, {\n    mask: String,\n    value: \"000\",\n    maxLength: 3,\n    minLength: 3,\n    unmask: true // true|false|'typed'\n    // inputRef={el => this.input = el}  // access to nested input\n    // DO NOT USE onChange TO HANDLE CHANGES!\n    // USE onAccept INSTEAD\n    ,\n    onAccept: // depending on prop above first argument is\n    // `value` if `unmask=false`,\n    // `unmaskedValue` if `unmask=true`,\n    // `typedValue` if `unmask='typed'`\n    (value, mask) => console.log(value) // ...and more mask props in a guide\n    // input props also available\n    ,\n    placeholder: \"Enter number here\"\n  })))), __jsx(\"div\", null, isCardPayment ? __jsx(\"div\", {\n    className: \"card-inputs\"\n  }, __jsx(_FormGroup.default, null, __jsx(_Label.default, {\n    htmlFor: \"cardholder-name\"\n  }, \"Nombre impreso en tarjeta\"), __jsx(_Input.default, {\n    id: \"cardholder-name\",\n    name: \"cardholder-name\",\n    required: requireds,\n    type: \"text\"\n  })), __jsx(_FormGroup.default, null, __jsx(\"div\", {\n    id: \"card-secure-fields\"\n  }), __jsx(_InvalidFeedback.default, {\n    error: error,\n    loading: loading,\n    name: \"payment_os\"\n  })), __jsx(_button.default, {\n    block: true,\n    color: \"secondary\",\n    type: \"button\",\n    disabled: loading,\n    loading: loading,\n    onClick: submitCredit\n  }, \"Pagar\")) // cash payment methods\n  : values.payment_method_id === 3 && __jsx(_FormGroup.default, null, cashPaymentMethods == null ? __jsx(\"p\", null, \"Cargando...\") : cashPaymentMethods.length ? cashPaymentMethods.map((item, key) => __jsx(_InputRadio.default, {\n    key: key,\n    label: item.name,\n    name: \"cash_payment_method_id\",\n    onChange: onCashPaymentMethodChange,\n    state: values.cash_payment_method_id,\n    value: item.id\n  })) : __jsx(\"p\", null, \"Sin m\\xE9todo de pago configurado.\"), __jsx(_InvalidFeedback.default, {\n    error: error,\n    loading: loading,\n    name: \"cash_payment_method_id\"\n  }), __jsx(_button.default, {\n    block: true,\n    color: \"secondary\",\n    type: \"submit\",\n    disabled: loading,\n    loading: loading\n  }, \"Pagar\")))), __jsx(\"div\", {\n    className: \"col-md-6\"\n  }, __jsx(\"div\", {\n    class: \"product-summary\"\n  }, __jsx(\"div\", {\n    className: \"product-image\"\n  }, __jsx(\"img\", {\n    src: \"https://place-hold.it/280x125\",\n    alt: \"\"\n  })), __jsx(\"div\", {\n    className: \"product-name-group\"\n  }, __jsx(\"h6\", null, \"Voc\\xEA est\\xE1 comprando:\"), __jsx(\"p\", {\n    class: \"product-name\"\n  }, \"Assinatura LaU Play - \", __jsx(\"strong\", null, selectedPackage.name), \" recorrente\")), __jsx(\"div\", {\n    class: \"price-breakdown\"\n  }, __jsx(\"div\", {\n    className: \"checkout-total\"\n  }, __jsx(\"h6\", null, \"Total\"), __jsx(\"p\", {\n    class: \"price\"\n  }, \"$ \", selectedPackage.amount))))))));\n};\n\nvar _default = (0, _withAuth.default)(Payment, true);\n\nexports.default = _default;","map":{"version":3,"sources":["/Users/rafael/Projects/somosgad/dale/pages/register/wizard/payment.js"],"names":["IMaskInput","require","Payment","layoutProps","userData","package_id","packages","api","error","requireds","ready","status","selectedPackage","items","find","i","id","console","log","values","setValues","payment_method_id","payment_os","cash_payment_method_id","terms","discount_id","credit_card_number","due_date","cardImg","setCardImg","creditCard","setCreditCard","loading","setLoading","businessUnitPublicKey","isMercadoPagoReady","setIsMercadoPagoReady","MercadoPago","HAS_WINDOW","window","Mercadopago","credit_card_id","debit_card_id","isCardPayment","includes","_","setPublishableKey","onPaymentChange","e","parseInt","target","value","onCashPaymentMethodChange","handleInputChange","checked","name","type","handleInputChangeCreditCardNumber","cardnumber","length","bin","substring","getPaymentMethod","details","secure_thumbnail","paymentMethods","setPaymentMethods","getPaymentMethods","data","get","initSecureFields","cashPaymentMethods","setCashPaymentMethods","getCashPaymentMethods","createToken","promise","Promise","resolve","reject","additionalData","holder_name","document","getElementById","result","json","JSON","parse","token","submitCredit","preventDefault","paymentData","res","post","response","setError","request","map","paymentMethod","key","String","mask","item","amount"],"mappings":"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","sourcesContent":["import { useEffect, useState } from \"react\";\nimport FormGroup from \"~/components/layout/AuthModal/FormGroup\";\nimport Label from \"~/components/Form/Label\";\nimport Input from \"~/components/layout/AuthModal/Input\";\nimport InputRadio from \"~/components/Form/InputRadio\";\nimport withAuth from \"~/components/withAuth\";\nimport InvalidFeedback from \"~/components/Form/InvalidFeedback\"\nimport { HAS_WINDOW } from \"~/constants/constants\";\nimport useScript from \"@charlietango/use-script\";\nimport Select from \"~/components/Select/Select\";\nimport Button from \"~/components/button\";\nconst IMaskInput = require('react-imask').IMaskInput\n\n// import {IMaskInput} from 'react-imask';\n\nconst Payment = ({\n                   layoutProps,\n                   userData,\n                   package_id,\n                   packages,\n                   api,\n                   error,\n                   requireds\n                 }) => {\n\n  const [ready, status] = useScript('https://secure.mlstatic.com/sdk/javascript/v1/mercadopago.js')\n\n\n  let selectedPackage = null\n  if (packages && package_id) {\n    selectedPackage = packages.items.find(i => i.id == package_id)\n    console.log(selectedPackage)\n  }\n\n\n  const [values, setValues] = useState({\n    package_id: '',\n    payment_method_id: null,\n    payment_os: null,\n    cash_payment_method_id: null,\n    terms: null,\n    discount_id: null,\n    credit_card_number: null,\n    due_date: null\n  })\n  const [cardImg, setCardImg] = useState(null);\n  const [creditCard, setCreditCard] = useState(null);\n\n  const [loading, setLoading] = useState();\n\n  const businessUnitPublicKey = 'TEST-7205c1be-9805-4308-bf00-6557c5b56b88'\n  const [isMercadoPagoReady, setIsMercadoPagoReady] = useState(false)\n  const MercadoPago = ready && HAS_WINDOW ? window.Mercadopago : null\n\n  const credit_card_id = 1\n  const debit_card_id = 2\n  const isCardPayment = [credit_card_id, debit_card_id].includes(values.payment_method_id)\n\n\n  useEffect(_ => {\n    if (MercadoPago) {\n      MercadoPago.setPublishableKey(businessUnitPublicKey)\n      setIsMercadoPagoReady(true)\n    }\n  }, [MercadoPago])\n\n\n  /* handle payment method change */\n  function onPaymentChange(e) {\n    setValues({\n      ...values,\n      payment_method_id: parseInt(e.target.value, 10),\n      cash_payment_method_id: null,\n    })\n  }\n\n  function onCashPaymentMethodChange(e) {\n    setValues({\n      ...values,\n      cash_payment_method_id: parseInt(e.target.value, 10),\n    })\n  }\n\n  const handleInputChange = e => {\n    const { checked, name, value, type } = e.target\n    setValues({\n      ...values,\n      [name]: type === 'checkbox' ?\n        (checked ? (value === 'true' ? true : value) : false) :\n        value,\n    })\n  }\n\n  const handleInputChangeCreditCardNumber = e => {\n\n    const { name, value } = e.target\n\n    setValues({\n      ...values,\n      [name]: value,\n    })\n\n    let cardnumber = value;\n\n    if (cardnumber.length >= 6) {\n      let bin = cardnumber.substring(0, 6);\n\n      MercadoPago.getPaymentMethod({\n        \"bin\": bin\n      }, (status, details) => {\n        setCardImg(details[0].secure_thumbnail);\n        setCreditCard(details[0]);\n      });\n\n    }\n  }\n\n  // payment methods\n  const [paymentMethods, setPaymentMethods] = useState()\n\n  // get payment methods\n  useEffect(_ => {\n    const getPaymentMethods = async _ => {\n      const { data } = await api.get('payment-methods')\n      setPaymentMethods(data)\n    }\n    getPaymentMethods()\n  }, [])\n\n  // init card secure fields\n  useEffect(_ => {\n    if (isMercadoPagoReady && isCardPayment) {\n      MercadoPago.initSecureFields('card-secure-fields')\n    }\n  }, [isMercadoPagoReady, isCardPayment])\n\n  // cash payment methods\n  const [cashPaymentMethods, setCashPaymentMethods] = useState()\n\n  // get cash payment methods\n  useEffect(_ => {\n    const getCashPaymentMethods = async _ => {\n      const { data } = await api.get('cash-payment-methods')\n      setCashPaymentMethods(data)\n    }\n    getCashPaymentMethods()\n  }, [])\n\n  /* token */\n  async function createToken() {\n\n    const promise = new Promise((resolve, reject) => {\n\n      const additionalData = {\n        holder_name: document.getElementById('cardholder-name').value,\n        // custom_data: document.getElementById('custom').value,\n      }\n\n      MercadoPago.createToken(additionalData, (result) => {\n        const json = JSON.parse(result)\n        console.log('json', json)\n        json.token ? resolve(json) : reject(json)\n      })\n\n    })\n\n    return promise\n\n  }\n\n\n  const submitCredit = async e => {\n\n\n    e.preventDefault();\n\n    setLoading(true);\n\n    const paymentData = values.package_id && values.payment_method_id && isCardPayment ? await createToken() : null\n\n    const data = { ...values, payment_os: paymentData }\n\n    try {\n\n      const res = await api.post(`register/subscribe`, {\n        package_id: package_id,\n        payment_method_id: values.payment_method_id,\n        token: \"\"\n      })\n\n      // handleSubmit(1)\n\n    } catch (error) {\n\n      if (error.response) {\n        const { data, status } = error.response\n        if (status === 422) {\n          setError(data)\n        }\n      } else if (error.request) {\n        setError(error)\n      } else {\n        setError(error)\n      }\n\n    } finally {\n      setLoading(false)\n    }\n\n\n  }\n\n  return (\n    <div className=\"row\">\n      <div className=\"offset-md-2 col-md-8\">\n\n        <h3 className=\"h3\">Pago</h3>\n\n        <div className=\"row\">\n\n          <div className=\"col-md-6 paymentMethod\">\n            <div className=\"row\">\n              <div className=\"col-12\">\n                <FormGroup>\n                  <Label htmlFor=\"payment_method_id\" style=\"margin: 0;\">Pague com</Label>\n                  <Select\n                    id=\"payment_method_id\"\n                    name=\"payment_method_id\"\n                    required={ requireds }\n                    onChange={ onPaymentChange }\n                    value={ values.payment_method_id }\n                  >\n                    <option value=\"0\">Selecione</option>\n                    { paymentMethods && paymentMethods.map((paymentMethod, key) => (\n                      <option\n                        key={ paymentMethod.id }\n                        state={ values.payment_method_id }\n                        value={ paymentMethod.id }\n                      >\n                        { paymentMethod.name }\n                      </option>\n                    )) }\n                  </Select>\n                  <InvalidFeedback error={ error } loading={ loading } name=\"gender_id\"/>\n                </FormGroup>\n              </div>\n              <div className=\"col-12\">\n                <FormGroup>\n                  <Label htmlFor=\"cardholder-name\">Nombre impreso en tarjeta</Label>\n                  <Input id=\"cardholder-name\" name=\"cardholder-name\" required={ requireds } type=\"text\"\n                         onChange={ handleInputChange }/>\n                </FormGroup>\n              </div>\n              <div className=\"col-12\">\n                <FormGroup>\n                  <Label htmlFor=\"card-number\">Nro Cartão</Label>\n                  <img src={ cardImg } class=\"creditCardBrand\"/>\n                  <Input id=\"card-number\" name=\"card-number\" value={ values.credit_card_number } required={ requireds }\n                         type=\"text\" onChange={ handleInputChangeCreditCardNumber } maxLength={ 19 }/>\n                </FormGroup>\n              </div>\n              <div className=\"col-6\">\n                <FormGroup>\n                  <Label htmlFor=\"card-duedate\">Dt Vencimento</Label>\n                  {/*<InputMask mask=\"99/99\" class=\"form-control\" value={values.due_date} onChange={handleInputChange} maskChar={null} placeholder={\"MM/YY\"}/>*/}\n                </FormGroup>\n              </div>\n              <div className=\"col-6\">\n                <FormGroup>\n                  <Label htmlFor=\"card-cvv\">CVV</Label>\n                  <IMaskInput\n                    mask={String}\n                    value=\"000\"\n                    maxLength={3}\n                    minLength={3}\n                    unmask={true} // true|false|'typed'\n                    // inputRef={el => this.input = el}  // access to nested input\n                    // DO NOT USE onChange TO HANDLE CHANGES!\n                    // USE onAccept INSTEAD\n                    onAccept={\n                      // depending on prop above first argument is\n                      // `value` if `unmask=false`,\n                      // `unmaskedValue` if `unmask=true`,\n                      // `typedValue` if `unmask='typed'`\n                      (value, mask) => console.log(value)\n                    }\n                    // ...and more mask props in a guide\n\n                    // input props also available\n                    placeholder='Enter number here'\n                  />\n                </FormGroup>\n              </div>\n            </div>\n            <div>\n              {/* credit / debit card */ }\n              { isCardPayment ? (\n                <div className=\"card-inputs\">\n\n                  <FormGroup>\n                    <Label htmlFor=\"cardholder-name\">Nombre impreso en tarjeta</Label>\n                    <Input id=\"cardholder-name\" name=\"cardholder-name\" required={ requireds } type=\"text\"/>\n                  </FormGroup>\n\n                  {/* mandatory data */ }\n\n                  {/* card fields */ }\n                  <FormGroup>\n                    <div id=\"card-secure-fields\"/>\n                    <InvalidFeedback error={ error } loading={ loading } name=\"payment_os\"/>\n                  </FormGroup>\n\n\n                  <Button block color=\"secondary\" type=\"button\" disabled={ loading }\n                          loading={ loading } onClick={ submitCredit }>Pagar</Button>\n                </div>\n\n                // cash payment methods\n              ) : values.payment_method_id === 3 && (\n                <FormGroup>\n                  { cashPaymentMethods == null ? (\n                    <p>Cargando...</p>\n                  ) : cashPaymentMethods.length ? cashPaymentMethods.map((item, key) => (\n                    <InputRadio\n                      key={ key }\n                      label={ item.name }\n                      name=\"cash_payment_method_id\"\n                      onChange={ onCashPaymentMethodChange }\n                      state={ values.cash_payment_method_id }\n                      value={ item.id }\n                    />\n                  )) : (\n                    <p>Sin método de pago configurado.</p>\n                  ) }\n                  <InvalidFeedback error={ error } loading={ loading } name=\"cash_payment_method_id\"/>\n                  <Button block color=\"secondary\" type=\"submit\" disabled={ loading }\n                          loading={ loading }>Pagar</Button>\n                </FormGroup>\n              ) }\n            </div>\n          </div>\n\n          <div className=\"col-md-6\">\n            <div class=\"product-summary\">\n              <div className=\"product-image\">\n                <img src=\"https://place-hold.it/280x125\" alt=\"\"/>\n              </div>\n              <div className={ \"product-name-group\" }>\n                <h6>\n                  Você está comprando:\n                </h6>\n                <p class={ \"product-name\" }>\n                  Assinatura LaU Play - <strong>{ selectedPackage.name }</strong> recorrente\n                </p>\n              </div>\n              <div class={ \"price-breakdown\" }>\n                <div className=\"checkout-total\">\n                  <h6>\n                    Total\n                  </h6>\n                  <p class={ \"price\" }>\n                    $ { selectedPackage.amount }\n                  </p>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n  )\n}\n\nexport default withAuth(Payment, true);\n"]},"metadata":{},"sourceType":"script"}