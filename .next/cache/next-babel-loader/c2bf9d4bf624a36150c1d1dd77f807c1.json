{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n// next\nimport Link from 'next/link';\nimport Router from 'next/router'; // react\n\nimport { useField } from 'formik';\nimport { useContext, useEffect, useState } from 'react'; // components\n\nimport UserContext from '~/contexts/UserContext';\nimport Packages from '~/components/Packages';\nimport Payment from './payment';\nimport Button from '~/components/button';\nimport FormGroup from '~/components/layout/AuthModal/FormGroup'; // env\n\nimport { IS_PRODUCTION } from '~/constants/constants';\nimport { CONFIG } from '~/config'; // import Select       from '../Select/Select'\n\nimport Label from '~/components/layout/AuthModal/Label';\nimport Input from '~/components/layout/AuthModal/Input';\n\nvar ChangePlanForm = function ChangePlanForm(_ref) {\n  var api = _ref.api,\n      isPayUReady = _ref.isPayUReady,\n      packages = _ref.packages,\n      POS = _ref.POS;\n\n  var _ref2 = packages.items.find(function (item) {\n    return item.amount == 0;\n  }) || {},\n      free_package_id = _ref2.id;\n\n  var requireds = IS_PRODUCTION;\n  var debug = false && !IS_PRODUCTION;\n\n  var _useContext = useContext(UserContext),\n      user = _useContext.user,\n      updateUser = _useContext.updateUser;\n\n  var _useState = useState(false),\n      discount = _useState[0],\n      setDiscount = _useState[1];\n\n  var _useState2 = useState(),\n      supportersDiscount = _useState2[0],\n      setSupportersDiscount = _useState2[1];\n\n  var _useState3 = useState({\n    package_id: '',\n    payment_method_id: null,\n    payment_os: null,\n    cash_payment_method_id: null,\n    terms: null,\n    supporter_id: '',\n    alternate_supporter_id: ''\n  }),\n      values = _useState3[0],\n      setValues = _useState3[1];\n\n  var _useState4 = useState(),\n      loading = _useState4[0],\n      setLoading = _useState4[1];\n\n  var _useState5 = useState(),\n      error = _useState5[0],\n      setError = _useState5[1];\n  /* fill user form */\n\n\n  useEffect(function (_) {\n    if (user) {\n      setValues(_objectSpread({}, values));\n    }\n  }, [user]);\n  /* handle general input change */\n\n  var handleInputChange = function handleInputChange(e) {\n    var _e$target = e.target,\n        checked = _e$target.checked,\n        name = _e$target.name,\n        value = _e$target.value,\n        type = _e$target.type;\n    setValues(_objectSpread(_objectSpread({}, values), {}, _defineProperty({}, name, type === 'checkbox' ? checked ? value === 'true' ? true : value : false : value)));\n  };\n\n  var handleDiscountChange = function handleDiscountChange(e) {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      alternate_supporter_id: e.target.value\n    }));\n    setDiscount(e.target.value.length === 5);\n  };\n\n  var handleSupportersDiscountChange = function handleSupportersDiscountChange(e) {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      supporter_id: e.target.value\n    }));\n    setSupportersDiscount(e.target.value.length === 5);\n  };\n  /* handle package change */\n\n\n  function onPackageChange(e) {\n    var package_id = parseInt(e.target.value, 10);\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      package_id: package_id,\n      payment_method_id: package_id === free_package_id ? null : values.payment_method_id\n    }));\n  }\n  /* handle payment method change */\n\n\n  function onPaymentChange(e) {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      payment_method_id: parseInt(e.target.value, 10),\n      cash_payment_method_id: null\n    }));\n  }\n\n  function onCashPaymentMethodChange(e) {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      cash_payment_method_id: parseInt(e.target.value, 10)\n    }));\n  }\n  /* token */\n\n\n  function createToken() {\n    return _createToken.apply(this, arguments);\n  } // is card payment\n\n\n  function _createToken() {\n    _createToken = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var promise;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              promise = new Promise(function (resolve, reject) {\n                var additionalData = {\n                  holder_name: document.getElementById('cardholder-name').value // custom_data: document.getElementById('custom').value,\n\n                };\n                POS.createToken(additionalData, function (result) {\n                  var json = JSON.parse(result);\n                  console.log('json', json);\n                  json.token ? resolve(json) : reject(json);\n                });\n              });\n              return _context2.abrupt(\"return\", promise);\n\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n    return _createToken.apply(this, arguments);\n  }\n\n  var credit_card_id = 1;\n  var debit_card_id = 2;\n  var isCardPayment = [credit_card_id, debit_card_id].includes(values.payment_method_id);\n  /* submit */\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var paymentData, data, _yield$api$post, _yield$api$post$data, _user, order, _error$response, _data, status;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              setLoading(true);\n              _context.prev = 2;\n\n              if (!(values.package_id && values.package_id !== free_package_id && values.payment_method_id && isCardPayment)) {\n                _context.next = 9;\n                break;\n              }\n\n              _context.next = 6;\n              return createToken();\n\n            case 6:\n              _context.t0 = _context.sent;\n              _context.next = 10;\n              break;\n\n            case 9:\n              _context.t0 = null;\n\n            case 10:\n              paymentData = _context.t0;\n              data = _objectSpread(_objectSpread({}, values), {}, {\n                payment_os: paymentData\n              });\n              _context.prev = 12;\n              _context.next = 15;\n              return api.post('register/changePlan', data);\n\n            case 15:\n              _yield$api$post = _context.sent;\n              _yield$api$post$data = _yield$api$post.data;\n              _user = _yield$api$post$data.user;\n              order = _yield$api$post$data.order;\n              updateUser(_user);\n\n              if (order) {\n                Router.push({\n                  pathname: '/account/confirm',\n                  query: {\n                    download_link: order.download_link,\n                    link: order.link\n                  }\n                }, '/register/confirm');\n              } else {\n                Router.push('/');\n              }\n\n              _context.next = 27;\n              break;\n\n            case 23:\n              _context.prev = 23;\n              _context.t1 = _context[\"catch\"](12);\n              console.log('error', _context.t1);\n\n              if (_context.t1.response) {\n                _error$response = _context.t1.response, _data = _error$response.data, status = _error$response.status;\n\n                if (status === 422) {\n                  setError(_data);\n                }\n              } else if (_context.t1.request) {\n                setError(_context.t1);\n              } else {\n                setError(_context.t1);\n              }\n\n            case 27:\n              _context.next = 32;\n              break;\n\n            case 29:\n              _context.prev = 29;\n              _context.t2 = _context[\"catch\"](2);\n              setError(_context.t2.description ? {\n                errors: {\n                  payment_os: _context.t2.description\n                }\n              } : _context.t2);\n\n            case 32:\n              setLoading(false);\n\n            case 33:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[2, 29], [12, 23]]);\n    }));\n\n    return function handleSubmit(_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(\"form\", {\n    method: \"post\",\n    onSubmit: handleSubmit,\n    className: \"jsx-68435091\"\n  }, error && error.message && __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"invalid-feedback\"\n  }, error.message), debug && __jsx(\"pre\", {\n    className: \"jsx-68435091\"\n  }, JSON.stringify(values, null, 2)), __jsx(\"h3\", {\n    className: \"jsx-68435091\" + \" \" + \"h3\"\n  }, \"\\xBFEres Socio? Obt\\xE9n un descuento especial\"), __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"row\"\n  }, __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"col-md-6\"\n  }, __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"data\"\n  }, __jsx(FormGroup, null, __jsx(Label, {\n    htmlFor: \"supporter_id\"\n  }, \"Socio \", CONFIG.shortClubName), __jsx(Input, {\n    disabled: values.alternate_supporter_id,\n    id: \"supporter_id\",\n    maxLength: 5,\n    name: \"supporter_id\",\n    onChange: handleSupportersDiscountChange,\n    type: \"text\",\n    style: supportersDiscount ? {\n      backgroundColor: 'rgb(206, 249, 206)'\n    } : {},\n    value: values.supporter_id\n  })))), __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"col-md-6\"\n  }, __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"localization\"\n  }, __jsx(FormGroup, null, __jsx(Label, {\n    htmlFor: \"alternate_supporter_id\"\n  }, \"Somos \", CONFIG.shortClubName), __jsx(Input, {\n    disabled: values.supporter_id,\n    id: \"alternate_supporter_id\",\n    maxLength: 5,\n    name: \"alternate_supporter_id\",\n    onChange: handleDiscountChange,\n    type: \"text\",\n    style: discount ? {\n      backgroundColor: 'rgb(206, 249, 206)'\n    } : {},\n    value: values.alternate_supporter_id\n  }))))), __jsx(Packages, {\n    error: packages.error ? packages.error : null,\n    items: packages.items ? packages.items : null,\n    onChange: onPackageChange,\n    package_id: values.package_id,\n    validationError: !loading && error && error.errors && error.errors.package_id,\n    discount: discount,\n    supportersDiscount: supportersDiscount\n  }), values.package_id && values.package_id !== free_package_id && __jsx(Payment, {\n    api: api,\n    cash_payment_method_id: values.cash_payment_method_id,\n    error: error,\n    isCardPayment: isCardPayment,\n    isPayUReady: isPayUReady,\n    loading: loading,\n    onCashPaymentMethodChange: onCashPaymentMethodChange,\n    onChange: onPaymentChange,\n    payment_method_id: values.payment_method_id,\n    POS: POS,\n    requireds: requireds,\n    validationError: !loading && error && error.errors && error.errors.payment_method_id\n  }), __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"row align-items-center\"\n  }, __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"col-md-6 offset-md-4\"\n  }, __jsx(\"label\", {\n    className: \"jsx-68435091\" + \" \" + \"terms\"\n  }, __jsx(\"input\", {\n    checked: values.terms,\n    name: \"terms\",\n    onChange: handleInputChange,\n    required: requireds,\n    type: \"checkbox\",\n    value: true,\n    className: \"jsx-68435091\"\n  }), __jsx(\"span\", {\n    className: \"jsx-68435091\"\n  }, \"He le\\xEDdo y acepto \", __jsx(Link, {\n    href: \"/terminos-y-politicas\"\n  }, __jsx(\"a\", {\n    target: \"_blank\",\n    className: \"jsx-68435091\"\n  }, \"el contrato\")), \" de \", CONFIG.appName)), !loading && error && error.errors && error.errors.terms && __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"invalid-feedback\"\n  }, error.errors.terms)), __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"col-md-2 text-right\"\n  }, __jsx(Button, {\n    block: true,\n    color: \"secondary\",\n    disabled: loading,\n    type: \"submit\"\n  }, \"Enviar\"))), __jsx(_JSXStyle, {\n    id: \"68435091\"\n  }, [\".h3{font-size:20px;font-weight:bold;margin-bottom:10px;}\", \"hr.jsx-68435091,.hr.jsx-68435091{margin-top:0;margin-bottom:15px;}\", \"@media (min-width:768px){.card-inputs.jsx-68435091{margin-top:-21px;}}\", \".terms.jsx-68435091{font-size:18px;}\", \".terms.jsx-68435091 input.jsx-68435091{margin-right:5px;}\", \".valid-number.jsx-68435091{background-color:rgb(206,249,206);}\"]));\n}; // create formik input field\n\n\nexport var FkInput = function FkInput(_ref4) {\n  var style = _ref4.style,\n      label = _ref4.label,\n      props = _objectWithoutProperties(_ref4, [\"style\", \"label\"]);\n\n  var _useField = useField(props),\n      _useField2 = _slicedToArray(_useField, 2),\n      field = _useField2[0],\n      meta = _useField2[1];\n\n  field.value = field.value || '';\n  return __jsx(React.Fragment, null, props.type == 'hidden' ? '' : __jsx(Label, {\n    htmlFor: props.id || props.name\n  }, label), __jsx(Input, _extends({\n    style: _objectSpread({\n      color: 'black'\n    }, style)\n  }, field, props)), meta.touched && meta.error ? __jsx(\"div\", {\n    className: \"invalid-feedback\"\n  }, meta.error) : null);\n};\nexport default ChangePlanForm;","map":{"version":3,"sources":["/Users/rafael/Projects/somosgad/dale/pages/user/changePlan/form.js"],"names":["Link","Router","useField","useContext","useEffect","useState","UserContext","Packages","Payment","Button","FormGroup","IS_PRODUCTION","CONFIG","Label","Input","ChangePlanForm","api","isPayUReady","packages","POS","items","find","item","amount","free_package_id","id","requireds","debug","user","updateUser","discount","setDiscount","supportersDiscount","setSupportersDiscount","package_id","payment_method_id","payment_os","cash_payment_method_id","terms","supporter_id","alternate_supporter_id","values","setValues","loading","setLoading","error","setError","_","handleInputChange","e","target","checked","name","value","type","handleDiscountChange","length","handleSupportersDiscountChange","onPackageChange","parseInt","onPaymentChange","onCashPaymentMethodChange","createToken","promise","Promise","resolve","reject","additionalData","holder_name","document","getElementById","result","json","JSON","parse","console","log","token","credit_card_id","debit_card_id","isCardPayment","includes","handleSubmit","preventDefault","paymentData","data","post","order","push","pathname","query","download_link","link","response","status","request","description","errors","message","stringify","shortClubName","backgroundColor","onChange","validationError","appName","FkInput","style","label","props","field","meta","color","touched"],"mappings":"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","sourcesContent":["// next\nimport Link   from 'next/link'\nimport Router from 'next/router'\n\n// react\nimport { useField } from 'formik'\nimport { useContext, useEffect, useState } from 'react'\n\n// components\nimport UserContext  from '~/contexts/UserContext'\nimport Packages     from '~/components/Packages'\nimport Payment      from './payment'\nimport Button       from '~/components/button'\nimport FormGroup    from '~/components/layout/AuthModal/FormGroup'\n\n// env\nimport { IS_PRODUCTION } from '~/constants/constants'\nimport { CONFIG } from '~/config'\n\n// import Select       from '../Select/Select'\nimport Label        from '~/components/layout/AuthModal/Label'\nimport Input        from '~/components/layout/AuthModal/Input'\n\n\nconst ChangePlanForm = ({ api, isPayUReady, packages, POS }) => {\n\n  const { id: free_package_id } = packages.items.find(item => item.amount == 0) || {}\n\n  const requireds = IS_PRODUCTION\n  const debug = false && ! IS_PRODUCTION\n\n  const { user, updateUser } = useContext(UserContext)\n\n  const [ discount, setDiscount ] = useState(false)\n  const [ supportersDiscount, setSupportersDiscount ] = useState()\n  const [ values, setValues ] = useState({\n    package_id: '',\n    payment_method_id: null,\n    payment_os: null,\n    cash_payment_method_id: null,\n    terms: null,\n    supporter_id: '',\n    alternate_supporter_id: '',\n  })\n\n  const [ loading, setLoading ] = useState()\n  const [ error, setError ] = useState()\n\n  /* fill user form */\n  useEffect(_ => {\n    if (user) {\n      setValues({\n        ...values\n      })\n    }\n  }, [user])\n\n  /* handle general input change */\n  const handleInputChange = e => {\n    const { checked, name, value, type } = e.target\n    setValues({\n      ...values,\n      [name]: type === 'checkbox' ?\n        (checked ? (value === 'true' ? true : value) : false) :\n        value,\n    })\n  }\n\n  const handleDiscountChange = e => {\n    setValues({\n      ...values,\n      alternate_supporter_id: e.target.value,\n    })\n    setDiscount(e.target.value.length === 5)\n  }\n\n  const handleSupportersDiscountChange = e => {\n    setValues({\n      ...values,\n      supporter_id: e.target.value,\n    })\n    setSupportersDiscount(e.target.value.length === 5)\n  }\n\n  /* handle package change */\n  function onPackageChange(e) {\n    const package_id = parseInt(e.target.value, 10)\n    setValues({\n      ...values,\n      package_id: package_id,\n      payment_method_id: package_id === free_package_id ? null : values.payment_method_id,\n    })\n  }\n\n  /* handle payment method change */\n  function onPaymentChange(e) {\n    setValues({\n      ...values,\n      payment_method_id: parseInt(e.target.value, 10),\n      cash_payment_method_id: null,\n    })\n  }\n\n  function onCashPaymentMethodChange(e) {\n    setValues({\n      ...values,\n      cash_payment_method_id: parseInt(e.target.value, 10),\n    })\n  }\n\n  /* token */\n  async function createToken() {\n    const promise = new Promise((resolve, reject) => {\n      const additionalData = {\n        holder_name: document.getElementById('cardholder-name').value,\n        // custom_data: document.getElementById('custom').value,\n      }\n      POS.createToken(additionalData, (result) => {\n        const json = JSON.parse(result)\n        console.log('json', json)\n        json.token ? resolve(json) : reject(json)\n      })\n    })\n    return promise\n  }\n\n  // is card payment\n  const credit_card_id = 1\n  const debit_card_id = 2\n  const isCardPayment = [credit_card_id, debit_card_id].includes(values.payment_method_id)\n\n  /* submit */\n  const handleSubmit = async e => {\n    e.preventDefault()\n    setLoading(true)\n    try {\n      const paymentData = values.package_id && values.package_id !== free_package_id &&\n        values.payment_method_id && isCardPayment ? await createToken() : null\n      const data = { ...values, payment_os: paymentData }\n      try {\n        const { data: { user, order } } = await api.post('register/changePlan', data)\n        updateUser(user)\n        if (order) {\n          Router.push({\n            pathname: '/account/confirm',\n            query: {\n              download_link: order.download_link,\n              link: order.link,\n            },\n          }, '/register/confirm')\n        } else {\n          Router.push('/')\n        }\n      } catch (error) {\n        console.log('error', error)\n        if (error.response) {\n          const { data, status } = error.response\n          if (status === 422) {\n            setError(data)\n          }\n        } else if (error.request) {\n          setError(error)\n        } else {\n          setError(error)\n        }\n      }\n    } catch (error) {\n      setError(error.description ? { errors: { payment_os: error.description } } : error)\n    }\n    setLoading(false)\n  }\n\n  return (\n    <form method=\"post\" onSubmit={handleSubmit}>\n\n      {/* main error msg */}\n      { error && error.message && (\n        <div className=\"invalid-feedback\">{error.message}</div>\n      ) }\n\n      {/* form data debug */}\n      { debug && (\n        <pre>\n          {JSON.stringify(values, null, 2)}\n        </pre>\n      )}\n\n      <h3 className=\"h3\">¿Eres Socio? Obtén un descuento especial</h3>\n        <div className=\"row\">\n          <div className=\"col-md-6\">\n            <div className=\"data\">\n              <FormGroup>\n                <Label htmlFor=\"supporter_id\">Socio {CONFIG.shortClubName}</Label>\n                <Input\n                  disabled={values.alternate_supporter_id}\n                  id=\"supporter_id\"\n                  maxLength={5}\n                  name=\"supporter_id\"\n                  onChange={handleSupportersDiscountChange}\n                  type=\"text\"\n                  style={supportersDiscount ? {backgroundColor: 'rgb(206, 249, 206)'} : {}}\n                  value={values.supporter_id}\n                />\n              </FormGroup>\n            </div>\n          </div>\n          <div className=\"col-md-6\">\n            <div className=\"localization\">\n              <FormGroup>\n                <Label htmlFor=\"alternate_supporter_id\">Somos {CONFIG.shortClubName}</Label>\n                <Input\n                  disabled={values.supporter_id}\n                  id=\"alternate_supporter_id\"\n                  maxLength={5}\n                  name=\"alternate_supporter_id\"\n                  onChange={handleDiscountChange}\n                  type=\"text\"\n                  style={discount ? {backgroundColor: 'rgb(206, 249, 206)'} : {}}\n                  value={values.alternate_supporter_id}\n                />\n              </FormGroup>\n            </div>\n          </div>\n        </div>\n\n\n      {/* package selection */}\n      <Packages {...{\n        error: packages.error ? packages.error : null,\n        items: packages.items ? packages.items : null,\n        onChange: onPackageChange,\n        package_id: values.package_id,\n        validationError: ! loading && error && error.errors && error.errors.package_id,\n        discount,\n        supportersDiscount,\n      }} />\n\n      {/* payment */}\n      { values.package_id && values.package_id !== free_package_id && (\n        <Payment {...{\n          api,\n          cash_payment_method_id: values.cash_payment_method_id,\n          error,\n          isCardPayment,\n          isPayUReady,\n          loading,\n          onCashPaymentMethodChange,\n          onChange: onPaymentChange,\n          payment_method_id: values.payment_method_id,\n          POS,\n          requireds,\n          validationError: ! loading && error && error.errors && error.errors.payment_method_id,\n        }} />\n      ) }\n\n      {/* footer */}\n      <div className=\"row align-items-center\">\n\n        {/* terms */}\n        <div className=\"col-md-6 offset-md-4\">\n          <label className=\"terms\">\n            <input\n              checked={values.terms}\n              name=\"terms\"\n              onChange={handleInputChange}\n              required={requireds}\n              type=\"checkbox\"\n              value={true}\n            />\n            <span>He leído y acepto <Link href=\"/terminos-y-politicas\">\n                <a target=\"_blank\">el contrato</a>\n              </Link> de {CONFIG.appName}</span>\n          </label>\n          { ! loading && error && error.errors && error.errors.terms && (\n            <div className=\"invalid-feedback\">{error.errors.terms}</div>\n          ) }\n        </div>\n\n        {/* send btn */}\n        <div className=\"col-md-2 text-right\">\n          <Button block color=\"secondary\" disabled={loading} type=\"submit\">Enviar</Button>\n        </div>\n\n      </div>\n\n      <style jsx>{`\n        :global(.h3) {\n          font-size: 20px;\n          font-weight: bold;\n          margin-bottom: 10px;\n        }\n        hr,\n        .hr {\n          margin-top: 0;\n          margin-bottom: 15px;\n        }\n        @media (min-width: 768px) {\n          .card-inputs {\n            margin-top: -21px;\n          }\n        }\n        .terms {\n          font-size: 18px;\n        }\n        .terms input {\n          margin-right: 5px;\n        }\n        .valid-number {\n          background-color: rgb(206, 249, 206);\n        }\n      `}</style>\n    </form>\n  )\n}\n\n// create formik input field\nexport const FkInput = ({ style, label, ...props }) => {\n  const [field, meta] = useField(props)\n  field.value = field.value || ''\n\n  return (\n    <>\n      { props.type == 'hidden' ? '' : <Label htmlFor={props.id || props.name}>{label}</Label> }\n      <Input style={{color: 'black', ...style}}  {...field} {...props} />\n      {meta.touched && meta.error ? ( <div className=\"invalid-feedback\">{ meta.error }</div> ) : null}\n    </>\n  )\n}\n\nexport default ChangePlanForm\n"]},"metadata":{},"sourceType":"module"}