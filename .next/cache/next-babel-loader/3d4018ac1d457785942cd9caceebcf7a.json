{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useEffect, useState } from \"react\";\nimport FormGroup from \"~/components/layout/AuthModal/FormGroup\";\nimport Label from \"~/components/Form/Label\";\nimport Input from \"~/components/layout/AuthModal/Input\";\nimport InputRadio from \"~/components/Form/InputRadio\";\nimport withAuth from \"~/components/withAuth\";\nimport InvalidFeedback from \"~/components/Form/InvalidFeedback\";\nimport { HAS_WINDOW } from \"~/constants/constants\";\nimport useScript from \"@charlietango/use-script\";\nimport Select from \"~/components/Select/Select\";\nimport Button from \"~/components/button\";\n\nvar Payment = function Payment(_ref) {\n  _s();\n\n  var layoutProps = _ref.layoutProps,\n      package_id = _ref.package_id,\n      packages = _ref.packages,\n      api = _ref.api,\n      error = _ref.error,\n      requireds = _ref.requireds;\n\n  var _useScript = useScript('https://secure.mlstatic.com/sdk/javascript/v1/mercadopago.js'),\n      _useScript2 = _slicedToArray(_useScript, 2),\n      ready = _useScript2[0],\n      status = _useScript2[1];\n\n  var selectedPackage = null;\n\n  if (packages && package_id) {\n    selectedPackage = packages.items.find(function (i) {\n      return i.id == package_id;\n    });\n    console.log(selectedPackage);\n  }\n\n  var _useState = useState({\n    package_id: '',\n    payment_method_id: null,\n    payment_os: null,\n    cash_payment_method_id: null,\n    terms: null,\n    discount_id: null\n  }),\n      values = _useState[0],\n      setValues = _useState[1];\n\n  var _useState2 = useState(),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var businessUnitPublicKey = 'TEST-7205c1be-9805-4308-bf00-6557c5b56b88';\n\n  var _useState3 = useState(false),\n      isMercadoPagoReady = _useState3[0],\n      setIsMercadoPagoReady = _useState3[1];\n\n  var MercadoPago = ready && HAS_WINDOW ? window.MercadoPago : null;\n  var credit_card_id = 1;\n  var debit_card_id = 2;\n  var isCardPayment = [credit_card_id, debit_card_id].includes(values.payment_method_id);\n  console.log(MercadoPago);\n  useEffect(function (_) {\n    if (MercadoPago) {\n      MercadoPago.setPublishableKey(businessUnitPublicKey);\n      setIsMercadoPagoReady(true);\n    }\n  }, [MercadoPago]);\n  /* handle payment method change */\n\n  function onPaymentChange(e) {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      payment_method_id: parseInt(e.target.value, 10),\n      cash_payment_method_id: null\n    }));\n  }\n\n  function onCashPaymentMethodChange(e) {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      cash_payment_method_id: parseInt(e.target.value, 10)\n    }));\n  }\n\n  var handleInputChange = function handleInputChange(e) {\n    var _e$target = e.target,\n        checked = _e$target.checked,\n        name = _e$target.name,\n        value = _e$target.value,\n        type = _e$target.type;\n    setValues(_objectSpread(_objectSpread({}, values), {}, _defineProperty({}, name, type === 'checkbox' ? checked ? value === 'true' ? true : value : false : value)));\n  }; // payment methods\n\n\n  var _useState4 = useState(),\n      paymentMethods = _useState4[0],\n      setPaymentMethods = _useState4[1]; // get payment methods\n\n\n  useEffect(function (_) {\n    var getPaymentMethods = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_) {\n        var _yield$api$get, data;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return api.get('payment-methods');\n\n              case 2:\n                _yield$api$get = _context.sent;\n                data = _yield$api$get.data;\n                setPaymentMethods(data);\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function getPaymentMethods(_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    getPaymentMethods();\n  }, []); // init card secure fields\n\n  useEffect(function (_) {\n    if (isMercadoPagoReady && isCardPayment) {\n      MercadoPago.initSecureFields('card-secure-fields');\n    }\n  }, [isMercadoPagoReady, isCardPayment]); // cash payment methods\n\n  var _useState5 = useState(),\n      cashPaymentMethods = _useState5[0],\n      setCashPaymentMethods = _useState5[1]; // get cash payment methods\n\n\n  useEffect(function (_) {\n    var getCashPaymentMethods = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_) {\n        var _yield$api$get2, data;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return api.get('cash-payment-methods');\n\n              case 2:\n                _yield$api$get2 = _context2.sent;\n                data = _yield$api$get2.data;\n                setCashPaymentMethods(data);\n\n              case 5:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function getCashPaymentMethods(_x2) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    getCashPaymentMethods();\n  }, []);\n  /* token */\n\n  function createToken() {\n    return _createToken.apply(this, arguments);\n  }\n\n  function _createToken() {\n    _createToken = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      var promise;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              promise = new Promise(function (resolve, reject) {\n                var additionalData = {\n                  holder_name: document.getElementById('cardholder-name').value // custom_data: document.getElementById('custom').value,\n\n                };\n                MercadoPago.createToken(additionalData, function (result) {\n                  var json = JSON.parse(result);\n                  console.log('json', json);\n                  json.token ? resolve(json) : reject(json);\n                });\n              });\n              return _context4.abrupt(\"return\", promise);\n\n            case 2:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n    return _createToken.apply(this, arguments);\n  }\n\n  var submitCredit = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e) {\n      var paymentData, data, res, _error$response, _data, _status;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              e.preventDefault();\n              setLoading(true);\n\n              if (!(values.package_id && values.payment_method_id && isCardPayment)) {\n                _context3.next = 8;\n                break;\n              }\n\n              _context3.next = 5;\n              return createToken();\n\n            case 5:\n              _context3.t0 = _context3.sent;\n              _context3.next = 9;\n              break;\n\n            case 8:\n              _context3.t0 = null;\n\n            case 9:\n              paymentData = _context3.t0;\n              data = _objectSpread(_objectSpread({}, values), {}, {\n                payment_os: paymentData\n              });\n              _context3.prev = 11;\n              _context3.next = 14;\n              return api.post(\"register/subscribe\", {\n                package_id: package_id,\n                payment_method_id: values.payment_method_id\n              });\n\n            case 14:\n              res = _context3.sent;\n              _context3.next = 20;\n              break;\n\n            case 17:\n              _context3.prev = 17;\n              _context3.t1 = _context3[\"catch\"](11);\n\n              if (_context3.t1.response) {\n                _error$response = _context3.t1.response, _data = _error$response.data, _status = _error$response.status;\n\n                if (_status === 422) {\n                  setError(_data);\n                }\n              } else if (_context3.t1.request) {\n                setError(_context3.t1);\n              } else {\n                setError(_context3.t1);\n              }\n\n            case 20:\n              _context3.prev = 20;\n              setLoading(false);\n              return _context3.finish(20);\n\n            case 23:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[11, 17, 20, 23]]);\n    }));\n\n    return function submitCredit(_x3) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(\"div\", {\n    className: \"row\"\n  }, __jsx(\"div\", {\n    className: \"offset-md-2 col-md-8\"\n  }, __jsx(\"h3\", {\n    className: \"h3\"\n  }, \"Pago\"), __jsx(\"div\", {\n    className: \"row\"\n  }, __jsx(\"div\", {\n    className: \"col-md-6 paymentMethod\"\n  }, __jsx(\"div\", null, __jsx(FormGroup, null, __jsx(Label, {\n    htmlFor: \"payment_method_id\",\n    style: \"margin: 0;\"\n  }, \"Pague com\"), __jsx(Select, {\n    id: \"payment_method_id\",\n    name: \"payment_method_id\",\n    required: requireds,\n    onChange: onPaymentChange,\n    value: values.payment_method_id\n  }, __jsx(\"option\", {\n    value: \"0\"\n  }, \"Selecione\"), paymentMethods && paymentMethods.map(function (paymentMethod, key) {\n    return __jsx(\"option\", {\n      key: paymentMethod.id,\n      state: values.payment_method_id,\n      value: paymentMethod.id\n    }, paymentMethod.name);\n  })), __jsx(InvalidFeedback, {\n    error: error,\n    loading: loading,\n    name: \"gender_id\"\n  }))), __jsx(\"div\", null, isCardPayment ? __jsx(\"div\", {\n    className: \"card-inputs\"\n  }, __jsx(FormGroup, null, __jsx(Label, {\n    htmlFor: \"cardholder-name\"\n  }, \"Nombre impreso en tarjeta\"), __jsx(Input, {\n    id: \"cardholder-name\",\n    name: \"cardholder-name\",\n    required: requireds,\n    type: \"text\"\n  })), __jsx(FormGroup, null, __jsx(\"div\", {\n    id: \"card-secure-fields\"\n  }), __jsx(InvalidFeedback, {\n    error: error,\n    loading: loading,\n    name: \"payment_os\"\n  })), __jsx(Button, {\n    block: true,\n    color: \"secondary\",\n    type: \"button\",\n    disabled: loading,\n    loading: loading,\n    onClick: submitCredit\n  }, \"Pagar\")) // cash payment methods\n  : values.payment_method_id === 3 && __jsx(FormGroup, null, cashPaymentMethods == null ? __jsx(\"p\", null, \"Cargando...\") : cashPaymentMethods.length ? cashPaymentMethods.map(function (item, key) {\n    return __jsx(InputRadio, {\n      key: key,\n      label: item.name,\n      name: \"cash_payment_method_id\",\n      onChange: onCashPaymentMethodChange,\n      state: values.cash_payment_method_id,\n      value: item.id\n    });\n  }) : __jsx(\"p\", null, \"Sin m\\xE9todo de pago configurado.\"), __jsx(InvalidFeedback, {\n    error: error,\n    loading: loading,\n    name: \"cash_payment_method_id\"\n  }), __jsx(Button, {\n    block: true,\n    color: \"secondary\",\n    type: \"submit\",\n    disabled: loading,\n    loading: loading\n  }, \"Pagar\")))), __jsx(\"div\", {\n    className: \"col-md-6\"\n  }, __jsx(\"div\", {\n    \"class\": \"product-summary\"\n  }, __jsx(\"div\", {\n    className: \"product-image\"\n  }, __jsx(\"img\", {\n    src: \"https://place-hold.it/280x125\",\n    alt: \"\"\n  })), __jsx(\"div\", {\n    className: \"product-name-group\"\n  }, __jsx(\"h6\", null, \"Voc\\xEA est\\xE1 comprando:\"), __jsx(\"p\", {\n    \"class\": \"product-name\"\n  }, \"Assinatura LaU Play - \", __jsx(\"strong\", null, selectedPackage.name), \" recorrente\")), __jsx(\"div\", {\n    \"class\": \"price-breakdown\"\n  }, __jsx(\"div\", {\n    className: \"checkout-total\"\n  }, __jsx(\"h6\", null, \"Total\"), __jsx(\"p\", {\n    \"class\": \"price\"\n  }, \"$ \", selectedPackage.amount))))))));\n};\n\n_s(Payment, \"pUqKxjfiwBbjfafsQY0/a5/gdwU=\", false, function () {\n  return [useScript];\n});\n\n_c = Payment;\nexport default _c2 = withAuth(Payment, true);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Payment\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["/Users/rafael/Projects/somosgad/dale/pages/register/wizard/payment.js"],"names":["useEffect","useState","FormGroup","Label","Input","InputRadio","withAuth","InvalidFeedback","HAS_WINDOW","useScript","Select","Button","Payment","layoutProps","package_id","packages","api","error","requireds","ready","status","selectedPackage","items","find","i","id","console","log","payment_method_id","payment_os","cash_payment_method_id","terms","discount_id","values","setValues","loading","setLoading","businessUnitPublicKey","isMercadoPagoReady","setIsMercadoPagoReady","MercadoPago","window","credit_card_id","debit_card_id","isCardPayment","includes","_","setPublishableKey","onPaymentChange","e","parseInt","target","value","onCashPaymentMethodChange","handleInputChange","checked","name","type","paymentMethods","setPaymentMethods","getPaymentMethods","get","data","initSecureFields","cashPaymentMethods","setCashPaymentMethods","getCashPaymentMethods","createToken","promise","Promise","resolve","reject","additionalData","holder_name","document","getElementById","result","json","JSON","parse","token","submitCredit","preventDefault","paymentData","post","res","response","setError","request","map","paymentMethod","key","length","item","amount"],"mappings":"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","sourcesContent":["import { useEffect, useState } from \"react\";\nimport FormGroup from \"~/components/layout/AuthModal/FormGroup\";\nimport Label from \"~/components/Form/Label\";\nimport Input from \"~/components/layout/AuthModal/Input\";\nimport InputRadio from \"~/components/Form/InputRadio\";\nimport withAuth from \"~/components/withAuth\";\nimport InvalidFeedback from \"~/components/Form/InvalidFeedback\"\nimport { HAS_WINDOW } from \"~/constants/constants\";\nimport useScript from \"@charlietango/use-script\";\nimport Select from \"~/components/Select/Select\";\nimport Button from \"~/components/button\";\n\nconst Payment = ({\n                   layoutProps,\n                   package_id,\n                   packages,\n                   api,\n                   error,\n                   requireds\n                 }) => {\n\n  const [ready, status] = useScript('https://secure.mlstatic.com/sdk/javascript/v1/mercadopago.js')\n\n\n  let selectedPackage = null\n  if (packages && package_id) {\n    selectedPackage = packages.items.find(i => i.id == package_id)\n    console.log(selectedPackage)\n  }\n\n\n  const [values, setValues] = useState({\n    package_id: '',\n    payment_method_id: null,\n    payment_os: null,\n    cash_payment_method_id: null,\n    terms: null,\n    discount_id: null,\n  })\n\n  const [loading, setLoading] = useState();\n\n  const businessUnitPublicKey = 'TEST-7205c1be-9805-4308-bf00-6557c5b56b88'\n  const [isMercadoPagoReady, setIsMercadoPagoReady] = useState(false)\n  const MercadoPago = ready && HAS_WINDOW ? window.MercadoPago : null\n\n  const credit_card_id = 1\n  const debit_card_id = 2\n  const isCardPayment = [credit_card_id, debit_card_id].includes(values.payment_method_id)\n\n\n  console.log(MercadoPago);\n\n  useEffect(_ => {\n    if (MercadoPago) {\n      MercadoPago.setPublishableKey(businessUnitPublicKey)\n      setIsMercadoPagoReady(true)\n    }\n  }, [MercadoPago])\n\n\n  /* handle payment method change */\n  function onPaymentChange(e) {\n    setValues({\n      ...values,\n      payment_method_id: parseInt(e.target.value, 10),\n      cash_payment_method_id: null,\n    })\n  }\n\n  function onCashPaymentMethodChange(e) {\n    setValues({\n      ...values,\n      cash_payment_method_id: parseInt(e.target.value, 10),\n    })\n  }\n\n  const handleInputChange = e => {\n    const { checked, name, value, type } = e.target\n    setValues({\n      ...values,\n      [name]: type === 'checkbox' ?\n        (checked ? (value === 'true' ? true : value) : false) :\n        value,\n    })\n  }\n\n  // payment methods\n  const [paymentMethods, setPaymentMethods] = useState()\n\n  // get payment methods\n  useEffect(_ => {\n    const getPaymentMethods = async _ => {\n      const { data } = await api.get('payment-methods')\n      setPaymentMethods(data)\n    }\n    getPaymentMethods()\n  }, [])\n\n  // init card secure fields\n  useEffect(_ => {\n    if (isMercadoPagoReady && isCardPayment) {\n      MercadoPago.initSecureFields('card-secure-fields')\n    }\n  }, [isMercadoPagoReady, isCardPayment])\n\n  // cash payment methods\n  const [cashPaymentMethods, setCashPaymentMethods] = useState()\n\n  // get cash payment methods\n  useEffect(_ => {\n    const getCashPaymentMethods = async _ => {\n      const { data } = await api.get('cash-payment-methods')\n      setCashPaymentMethods(data)\n    }\n    getCashPaymentMethods()\n  }, [])\n\n  /* token */\n  async function createToken() {\n\n    const promise = new Promise((resolve, reject) => {\n\n      const additionalData = {\n        holder_name: document.getElementById('cardholder-name').value,\n        // custom_data: document.getElementById('custom').value,\n      }\n\n      MercadoPago.createToken(additionalData, (result) => {\n        const json = JSON.parse(result)\n        console.log('json', json)\n        json.token ? resolve(json) : reject(json)\n      })\n\n    })\n\n    return promise\n\n  }\n\n\n  const submitCredit = async e => {\n    e.preventDefault();\n\n    setLoading(true);\n\n    const paymentData = values.package_id && values.payment_method_id && isCardPayment ? await createToken() : null\n\n    const data = { ...values, payment_os: paymentData }\n\n    try {\n\n      const res = await api.post(`register/subscribe`, {\n        package_id: package_id,\n        payment_method_id: values.payment_method_id,\n      })\n\n      // handleSubmit(1)\n\n    } catch (error) {\n\n      if (error.response) {\n        const { data, status } = error.response\n        if (status === 422) {\n          setError(data)\n        }\n      } else if (error.request) {\n        setError(error)\n      } else {\n        setError(error)\n      }\n\n    } finally {\n      setLoading(false)\n    }\n\n\n  }\n\n  return (\n    <div className=\"row\">\n      <div className=\"offset-md-2 col-md-8\">\n\n        <h3 className=\"h3\">Pago</h3>\n\n        <div className=\"row\">\n\n          <div className=\"col-md-6 paymentMethod\">\n            <div>\n              <FormGroup>\n                <Label htmlFor=\"payment_method_id\" style=\"margin: 0;\">Pague com</Label>\n                <Select\n                  id=\"payment_method_id\"\n                  name=\"payment_method_id\"\n                  required={ requireds }\n                  onChange={ onPaymentChange }\n                  value={ values.payment_method_id }\n                >\n                  <option value=\"0\">Selecione</option>\n                  { paymentMethods && paymentMethods.map((paymentMethod, key) => (\n                    <option\n                      key={ paymentMethod.id }\n                      state={ values.payment_method_id }\n                      value={ paymentMethod.id }\n                    >\n                      { paymentMethod.name }\n                    </option>\n                  )) }\n                </Select>\n                <InvalidFeedback error={ error } loading={ loading } name=\"gender_id\"/>\n              </FormGroup>\n            </div>\n            <div>\n              {/* credit / debit card */ }\n              { isCardPayment ? (\n                <div className=\"card-inputs\">\n\n                  {/* mandatory data */ }\n                  <FormGroup>\n                    <Label htmlFor=\"cardholder-name\">Nombre impreso en tarjeta</Label>\n                    <Input id=\"cardholder-name\" name=\"cardholder-name\" required={ requireds } type=\"text\"/>\n                  </FormGroup>\n\n                  {/* card fields */ }\n                  <FormGroup>\n                    <div id=\"card-secure-fields\"/>\n                    <InvalidFeedback error={ error } loading={ loading } name=\"payment_os\"/>\n                  </FormGroup>\n\n\n                  <Button block color=\"secondary\" type=\"button\" disabled={ loading }\n                          loading={ loading } onClick={ submitCredit }>Pagar</Button>\n                </div>\n\n                // cash payment methods\n              ) : values.payment_method_id === 3 && (\n                <FormGroup>\n                  { cashPaymentMethods == null ? (\n                    <p>Cargando...</p>\n                  ) : cashPaymentMethods.length ? cashPaymentMethods.map((item, key) => (\n                    <InputRadio\n                      key={ key }\n                      label={ item.name }\n                      name=\"cash_payment_method_id\"\n                      onChange={ onCashPaymentMethodChange }\n                      state={ values.cash_payment_method_id }\n                      value={ item.id }\n                    />\n                  )) : (\n                    <p>Sin método de pago configurado.</p>\n                  ) }\n                  <InvalidFeedback error={ error } loading={ loading } name=\"cash_payment_method_id\"/>\n                  <Button block color=\"secondary\" type=\"submit\" disabled={ loading }\n                          loading={ loading }>Pagar</Button>\n                </FormGroup>\n              ) }\n            </div>\n          </div>\n\n          <div className=\"col-md-6\">\n            <div class=\"product-summary\">\n              <div className=\"product-image\">\n                <img src=\"https://place-hold.it/280x125\" alt=\"\"/>\n              </div>\n              <div className={ \"product-name-group\" }>\n                <h6>\n                  Você está comprando:\n                </h6>\n                <p class={ \"product-name\" }>\n                  Assinatura LaU Play - <strong>{ selectedPackage.name }</strong> recorrente\n                </p>\n              </div>\n              <div class={ \"price-breakdown\" }>\n                <div className=\"checkout-total\">\n                  <h6>\n                    Total\n                  </h6>\n                  <p class={ \"price\" }>\n                    $ { selectedPackage.amount }\n                  </p>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n  )\n}\n\nexport default withAuth(Payment, true);\n"]},"metadata":{},"sourceType":"module"}