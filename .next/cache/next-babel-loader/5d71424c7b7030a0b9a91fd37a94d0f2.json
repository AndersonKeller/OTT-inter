{"ast":null,"code":"import _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n// next\nimport Link from 'next/link';\nimport Router from 'next/router'; // react\n\nimport { useField } from 'formik';\nimport { useContext, useEffect, useState } from 'react'; // components\n\nimport UserContext from '~/contexts/UserContext';\nimport Packages from '~/components/Packages';\nimport Payment from './payment';\nimport Button from '~/components/button';\nimport FormGroup from '~/components/layout/AuthModal/FormGroup'; // env\n\nimport { IS_PRODUCTION } from '~/constants/constants';\nimport { CONFIG } from '~/config'; // import Select       from '../Select/Select'\n\nimport Label from '~/components/layout/AuthModal/Label';\nimport Input from '~/components/layout/AuthModal/Input';\n\nconst ChangePlanForm = ({\n  api,\n  isPayUReady,\n  packages,\n  POS\n}) => {\n  const {\n    id: free_package_id\n  } = packages.items.find(item => item.amount == 0) || {};\n  const requireds = IS_PRODUCTION;\n  const debug = false && !IS_PRODUCTION;\n  const {\n    user,\n    updateUser\n  } = useContext(UserContext);\n  const {\n    0: discount,\n    1: setDiscount\n  } = useState(false);\n  const {\n    0: supportersDiscount,\n    1: setSupportersDiscount\n  } = useState();\n  const {\n    0: values,\n    1: setValues\n  } = useState({\n    package_id: '',\n    payment_method_id: null,\n    payment_os: null,\n    cash_payment_method_id: null,\n    terms: null,\n    supporter_id: '',\n    alternate_supporter_id: ''\n  });\n  const {\n    0: loading,\n    1: setLoading\n  } = useState();\n  const {\n    0: error,\n    1: setError\n  } = useState();\n  /* fill user form */\n\n  useEffect(_ => {\n    if (user) {\n      setValues(_objectSpread({}, values));\n    }\n  }, [user]);\n  /* handle general input change */\n\n  const handleInputChange = e => {\n    const {\n      checked,\n      name,\n      value,\n      type\n    } = e.target;\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      [name]: type === 'checkbox' ? checked ? value === 'true' ? true : value : false : value\n    }));\n  };\n\n  const handleDiscountChange = e => {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      alternate_supporter_id: e.target.value\n    }));\n    setDiscount(e.target.value.length === 5);\n  };\n\n  const handleSupportersDiscountChange = e => {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      supporter_id: e.target.value\n    }));\n    setSupportersDiscount(e.target.value.length === 5);\n  };\n  /* handle package change */\n\n\n  function onPackageChange(e) {\n    const package_id = parseInt(e.target.value, 10);\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      package_id: package_id,\n      payment_method_id: package_id === free_package_id ? null : values.payment_method_id\n    }));\n  }\n  /* handle payment method change */\n\n\n  function onPaymentChange(e) {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      payment_method_id: parseInt(e.target.value, 10),\n      cash_payment_method_id: null\n    }));\n  }\n\n  function onCashPaymentMethodChange(e) {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      cash_payment_method_id: parseInt(e.target.value, 10)\n    }));\n  }\n  /* token */\n\n\n  async function createToken() {\n    const promise = new Promise((resolve, reject) => {\n      const additionalData = {\n        holder_name: document.getElementById('cardholder-name').value // custom_data: document.getElementById('custom').value,\n\n      };\n      POS.createToken(additionalData, result => {\n        const json = JSON.parse(result);\n        console.log('json', json);\n        json.token ? resolve(json) : reject(json);\n      });\n    });\n    return promise;\n  } // is card payment\n\n\n  const credit_card_id = 1;\n  const debit_card_id = 2;\n  const isCardPayment = [credit_card_id, debit_card_id].includes(values.payment_method_id);\n  /* submit */\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      const paymentData = values.package_id && values.package_id !== free_package_id && values.payment_method_id && isCardPayment ? await createToken() : null;\n\n      const data = _objectSpread(_objectSpread({}, values), {}, {\n        payment_os: paymentData\n      });\n\n      try {\n        const {\n          data: {\n            user,\n            order\n          }\n        } = await api.post('register/changePlan', data);\n        updateUser(user);\n\n        if (order) {\n          Router.push({\n            pathname: '/account/confirm',\n            query: {\n              download_link: order.download_link,\n              link: order.link\n            }\n          }, '/register/confirm');\n        } else {\n          Router.push('/');\n        }\n      } catch (error) {\n        console.log('error', error);\n\n        if (error.response) {\n          const {\n            data,\n            status\n          } = error.response;\n\n          if (status === 422) {\n            setError(data);\n          }\n        } else if (error.request) {\n          setError(error);\n        } else {\n          setError(error);\n        }\n      }\n    } catch (error) {\n      setError(error.description ? {\n        errors: {\n          payment_os: error.description\n        }\n      } : error);\n    }\n\n    setLoading(false);\n  };\n\n  return __jsx(\"form\", {\n    method: \"post\",\n    onSubmit: handleSubmit,\n    className: \"jsx-68435091\"\n  }, error && error.message && __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"invalid-feedback\"\n  }, error.message), debug && __jsx(\"pre\", {\n    className: \"jsx-68435091\"\n  }, JSON.stringify(values, null, 2)), __jsx(\"h3\", {\n    className: \"jsx-68435091\" + \" \" + \"h3\"\n  }, \"\\xBFEres Socio? Obt\\xE9n un descuento especial\"), __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"row\"\n  }, __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"col-md-6\"\n  }, __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"data\"\n  }, __jsx(FormGroup, null, __jsx(Label, {\n    htmlFor: \"supporter_id\"\n  }, \"Socio \", CONFIG.shortClubName), __jsx(Input, {\n    disabled: values.alternate_supporter_id,\n    id: \"supporter_id\",\n    maxLength: 5,\n    name: \"supporter_id\",\n    onChange: handleSupportersDiscountChange,\n    type: \"text\",\n    style: supportersDiscount ? {\n      backgroundColor: 'rgb(206, 249, 206)'\n    } : {},\n    value: values.supporter_id\n  })))), __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"col-md-6\"\n  }, __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"localization\"\n  }, __jsx(FormGroup, null, __jsx(Label, {\n    htmlFor: \"alternate_supporter_id\"\n  }, \"Somos \", CONFIG.shortClubName), __jsx(Input, {\n    disabled: values.supporter_id,\n    id: \"alternate_supporter_id\",\n    maxLength: 5,\n    name: \"alternate_supporter_id\",\n    onChange: handleDiscountChange,\n    type: \"text\",\n    style: discount ? {\n      backgroundColor: 'rgb(206, 249, 206)'\n    } : {},\n    value: values.alternate_supporter_id\n  }))))), __jsx(Packages, {\n    error: packages.error ? packages.error : null,\n    items: packages.items ? packages.items : null,\n    onChange: onPackageChange,\n    package_id: values.package_id,\n    validationError: !loading && error && error.errors && error.errors.package_id,\n    discount,\n    supportersDiscount\n  }), values.package_id && values.package_id !== free_package_id && __jsx(Payment, {\n    api,\n    cash_payment_method_id: values.cash_payment_method_id,\n    error,\n    isCardPayment,\n    isPayUReady,\n    loading,\n    onCashPaymentMethodChange,\n    onChange: onPaymentChange,\n    payment_method_id: values.payment_method_id,\n    POS,\n    requireds,\n    validationError: !loading && error && error.errors && error.errors.payment_method_id\n  }), __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"row align-items-center\"\n  }, __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"col-md-6 offset-md-4\"\n  }, __jsx(\"label\", {\n    className: \"jsx-68435091\" + \" \" + \"terms\"\n  }, __jsx(\"input\", {\n    checked: values.terms,\n    name: \"terms\",\n    onChange: handleInputChange,\n    required: requireds,\n    type: \"checkbox\",\n    value: true,\n    className: \"jsx-68435091\"\n  }), __jsx(\"span\", {\n    className: \"jsx-68435091\"\n  }, \"He le\\xEDdo y acepto \", __jsx(Link, {\n    href: \"/terminos-y-politicas\"\n  }, __jsx(\"a\", {\n    target: \"_blank\",\n    className: \"jsx-68435091\"\n  }, \"el contrato\")), \" de \", CONFIG.appName)), !loading && error && error.errors && error.errors.terms && __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"invalid-feedback\"\n  }, error.errors.terms)), __jsx(\"div\", {\n    className: \"jsx-68435091\" + \" \" + \"col-md-2 text-right\"\n  }, __jsx(Button, {\n    block: true,\n    color: \"secondary\",\n    disabled: loading,\n    type: \"submit\"\n  }, \"Enviar\"))), __jsx(_JSXStyle, {\n    id: \"68435091\"\n  }, [\".h3{font-size:20px;font-weight:bold;margin-bottom:10px;}\", \"hr.jsx-68435091,.hr.jsx-68435091{margin-top:0;margin-bottom:15px;}\", \"@media (min-width:768px){.card-inputs.jsx-68435091{margin-top:-21px;}}\", \".terms.jsx-68435091{font-size:18px;}\", \".terms.jsx-68435091 input.jsx-68435091{margin-right:5px;}\", \".valid-number.jsx-68435091{background-color:rgb(206,249,206);}\"]));\n}; // create formik input field\n\n\nexport const FkInput = (_ref) => {\n  let {\n    style,\n    label\n  } = _ref,\n      props = _objectWithoutProperties(_ref, [\"style\", \"label\"]);\n\n  const [field, meta] = useField(props);\n  field.value = field.value || '';\n  return __jsx(React.Fragment, null, props.type == 'hidden' ? '' : __jsx(Label, {\n    htmlFor: props.id || props.name\n  }, label), __jsx(Input, _extends({\n    style: _objectSpread({\n      color: 'black'\n    }, style)\n  }, field, props)), meta.touched && meta.error ? __jsx(\"div\", {\n    className: \"invalid-feedback\"\n  }, meta.error) : null);\n};\nexport default ChangePlanForm;","map":{"version":3,"sources":["/Users/rafael/Projects/somosgad/dale/pages/user/changePlan/form.js"],"names":["Link","Router","useField","useContext","useEffect","useState","UserContext","Packages","Payment","Button","FormGroup","IS_PRODUCTION","CONFIG","Label","Input","ChangePlanForm","api","isPayUReady","packages","POS","id","free_package_id","items","find","item","amount","requireds","debug","user","updateUser","discount","setDiscount","supportersDiscount","setSupportersDiscount","values","setValues","package_id","payment_method_id","payment_os","cash_payment_method_id","terms","supporter_id","alternate_supporter_id","loading","setLoading","error","setError","_","handleInputChange","e","checked","name","value","type","target","handleDiscountChange","length","handleSupportersDiscountChange","onPackageChange","parseInt","onPaymentChange","onCashPaymentMethodChange","createToken","promise","Promise","resolve","reject","additionalData","holder_name","document","getElementById","result","json","JSON","parse","console","log","token","credit_card_id","debit_card_id","isCardPayment","includes","handleSubmit","preventDefault","paymentData","data","order","post","push","pathname","query","download_link","link","response","status","request","description","errors","message","stringify","shortClubName","backgroundColor","onChange","validationError","appName","FkInput","style","label","props","field","meta","color","touched"],"mappings":"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","sourcesContent":["// next\nimport Link   from 'next/link'\nimport Router from 'next/router'\n\n// react\nimport { useField } from 'formik'\nimport { useContext, useEffect, useState } from 'react'\n\n// components\nimport UserContext  from '~/contexts/UserContext'\nimport Packages     from '~/components/Packages'\nimport Payment      from './payment'\nimport Button       from '~/components/button'\nimport FormGroup    from '~/components/layout/AuthModal/FormGroup'\n\n// env\nimport { IS_PRODUCTION } from '~/constants/constants'\nimport { CONFIG } from '~/config'\n\n// import Select       from '../Select/Select'\nimport Label        from '~/components/layout/AuthModal/Label'\nimport Input        from '~/components/layout/AuthModal/Input'\n\n\nconst ChangePlanForm = ({ api, isPayUReady, packages, POS }) => {\n\n  const { id: free_package_id } = packages.items.find(item => item.amount == 0) || {}\n\n  const requireds = IS_PRODUCTION\n  const debug = false && ! IS_PRODUCTION\n\n  const { user, updateUser } = useContext(UserContext)\n\n  const [ discount, setDiscount ] = useState(false)\n  const [ supportersDiscount, setSupportersDiscount ] = useState()\n  const [ values, setValues ] = useState({\n    package_id: '',\n    payment_method_id: null,\n    payment_os: null,\n    cash_payment_method_id: null,\n    terms: null,\n    supporter_id: '',\n    alternate_supporter_id: '',\n  })\n\n  const [ loading, setLoading ] = useState()\n  const [ error, setError ] = useState()\n\n  /* fill user form */\n  useEffect(_ => {\n    if (user) {\n      setValues({\n        ...values\n      })\n    }\n  }, [user])\n\n  /* handle general input change */\n  const handleInputChange = e => {\n    const { checked, name, value, type } = e.target\n    setValues({\n      ...values,\n      [name]: type === 'checkbox' ?\n        (checked ? (value === 'true' ? true : value) : false) :\n        value,\n    })\n  }\n\n  const handleDiscountChange = e => {\n    setValues({\n      ...values,\n      alternate_supporter_id: e.target.value,\n    })\n    setDiscount(e.target.value.length === 5)\n  }\n\n  const handleSupportersDiscountChange = e => {\n    setValues({\n      ...values,\n      supporter_id: e.target.value,\n    })\n    setSupportersDiscount(e.target.value.length === 5)\n  }\n\n  /* handle package change */\n  function onPackageChange(e) {\n    const package_id = parseInt(e.target.value, 10)\n    setValues({\n      ...values,\n      package_id: package_id,\n      payment_method_id: package_id === free_package_id ? null : values.payment_method_id,\n    })\n  }\n\n  /* handle payment method change */\n  function onPaymentChange(e) {\n    setValues({\n      ...values,\n      payment_method_id: parseInt(e.target.value, 10),\n      cash_payment_method_id: null,\n    })\n  }\n\n  function onCashPaymentMethodChange(e) {\n    setValues({\n      ...values,\n      cash_payment_method_id: parseInt(e.target.value, 10),\n    })\n  }\n\n  /* token */\n  async function createToken() {\n    const promise = new Promise((resolve, reject) => {\n      const additionalData = {\n        holder_name: document.getElementById('cardholder-name').value,\n        // custom_data: document.getElementById('custom').value,\n      }\n      POS.createToken(additionalData, (result) => {\n        const json = JSON.parse(result)\n        console.log('json', json)\n        json.token ? resolve(json) : reject(json)\n      })\n    })\n    return promise\n  }\n\n  // is card payment\n  const credit_card_id = 1\n  const debit_card_id = 2\n  const isCardPayment = [credit_card_id, debit_card_id].includes(values.payment_method_id)\n\n  /* submit */\n  const handleSubmit = async e => {\n    e.preventDefault()\n    setLoading(true)\n    try {\n      const paymentData = values.package_id && values.package_id !== free_package_id &&\n        values.payment_method_id && isCardPayment ? await createToken() : null\n      const data = { ...values, payment_os: paymentData }\n      try {\n        const { data: { user, order } } = await api.post('register/changePlan', data)\n        updateUser(user)\n        if (order) {\n          Router.push({\n            pathname: '/account/confirm',\n            query: {\n              download_link: order.download_link,\n              link: order.link,\n            },\n          }, '/register/confirm')\n        } else {\n          Router.push('/')\n        }\n      } catch (error) {\n        console.log('error', error)\n        if (error.response) {\n          const { data, status } = error.response\n          if (status === 422) {\n            setError(data)\n          }\n        } else if (error.request) {\n          setError(error)\n        } else {\n          setError(error)\n        }\n      }\n    } catch (error) {\n      setError(error.description ? { errors: { payment_os: error.description } } : error)\n    }\n    setLoading(false)\n  }\n\n  return (\n    <form method=\"post\" onSubmit={handleSubmit}>\n\n      {/* main error msg */}\n      { error && error.message && (\n        <div className=\"invalid-feedback\">{error.message}</div>\n      ) }\n\n      {/* form data debug */}\n      { debug && (\n        <pre>\n          {JSON.stringify(values, null, 2)}\n        </pre>\n      )}\n\n      <h3 className=\"h3\">¿Eres Socio? Obtén un descuento especial</h3>\n        <div className=\"row\">\n          <div className=\"col-md-6\">\n            <div className=\"data\">\n              <FormGroup>\n                <Label htmlFor=\"supporter_id\">Socio {CONFIG.shortClubName}</Label>\n                <Input\n                  disabled={values.alternate_supporter_id}\n                  id=\"supporter_id\"\n                  maxLength={5}\n                  name=\"supporter_id\"\n                  onChange={handleSupportersDiscountChange}\n                  type=\"text\"\n                  style={supportersDiscount ? {backgroundColor: 'rgb(206, 249, 206)'} : {}}\n                  value={values.supporter_id}\n                />\n              </FormGroup>\n            </div>\n          </div>\n          <div className=\"col-md-6\">\n            <div className=\"localization\">\n              <FormGroup>\n                <Label htmlFor=\"alternate_supporter_id\">Somos {CONFIG.shortClubName}</Label>\n                <Input\n                  disabled={values.supporter_id}\n                  id=\"alternate_supporter_id\"\n                  maxLength={5}\n                  name=\"alternate_supporter_id\"\n                  onChange={handleDiscountChange}\n                  type=\"text\"\n                  style={discount ? {backgroundColor: 'rgb(206, 249, 206)'} : {}}\n                  value={values.alternate_supporter_id}\n                />\n              </FormGroup>\n            </div>\n          </div>\n        </div>\n\n\n      {/* package selection */}\n      <Packages {...{\n        error: packages.error ? packages.error : null,\n        items: packages.items ? packages.items : null,\n        onChange: onPackageChange,\n        package_id: values.package_id,\n        validationError: ! loading && error && error.errors && error.errors.package_id,\n        discount,\n        supportersDiscount,\n      }} />\n\n      {/* payment */}\n      { values.package_id && values.package_id !== free_package_id && (\n        <Payment {...{\n          api,\n          cash_payment_method_id: values.cash_payment_method_id,\n          error,\n          isCardPayment,\n          isPayUReady,\n          loading,\n          onCashPaymentMethodChange,\n          onChange: onPaymentChange,\n          payment_method_id: values.payment_method_id,\n          POS,\n          requireds,\n          validationError: ! loading && error && error.errors && error.errors.payment_method_id,\n        }} />\n      ) }\n\n      {/* footer */}\n      <div className=\"row align-items-center\">\n\n        {/* terms */}\n        <div className=\"col-md-6 offset-md-4\">\n          <label className=\"terms\">\n            <input\n              checked={values.terms}\n              name=\"terms\"\n              onChange={handleInputChange}\n              required={requireds}\n              type=\"checkbox\"\n              value={true}\n            />\n            <span>He leído y acepto <Link href=\"/terminos-y-politicas\">\n                <a target=\"_blank\">el contrato</a>\n              </Link> de {CONFIG.appName}</span>\n          </label>\n          { ! loading && error && error.errors && error.errors.terms && (\n            <div className=\"invalid-feedback\">{error.errors.terms}</div>\n          ) }\n        </div>\n\n        {/* send btn */}\n        <div className=\"col-md-2 text-right\">\n          <Button block color=\"secondary\" disabled={loading} type=\"submit\">Enviar</Button>\n        </div>\n\n      </div>\n\n      <style jsx>{`\n        :global(.h3) {\n          font-size: 20px;\n          font-weight: bold;\n          margin-bottom: 10px;\n        }\n        hr,\n        .hr {\n          margin-top: 0;\n          margin-bottom: 15px;\n        }\n        @media (min-width: 768px) {\n          .card-inputs {\n            margin-top: -21px;\n          }\n        }\n        .terms {\n          font-size: 18px;\n        }\n        .terms input {\n          margin-right: 5px;\n        }\n        .valid-number {\n          background-color: rgb(206, 249, 206);\n        }\n      `}</style>\n    </form>\n  )\n}\n\n// create formik input field\nexport const FkInput = ({ style, label, ...props }) => {\n  const [field, meta] = useField(props)\n  field.value = field.value || ''\n\n  return (\n    <>\n      { props.type == 'hidden' ? '' : <Label htmlFor={props.id || props.name}>{label}</Label> }\n      <Input style={{color: 'black', ...style}}  {...field} {...props} />\n      {meta.touched && meta.error ? ( <div className=\"invalid-feedback\">{ meta.error }</div> ) : null}\n    </>\n  )\n}\n\nexport default ChangePlanForm\n"]},"metadata":{},"sourceType":"module"}